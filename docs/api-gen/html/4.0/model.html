<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>wCMF 4.0: Model</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="A MDSD framework for building reliable, maintainable and extendable web applications with PHP">
  <meta name="keywords" content="PHP, web application framework, model driven development">
  <meta name="author" content="wemove digital solutions">
  <link rel="shortcut icon" href="theme/images/favicon.ico">
  <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
  <!--[if lt IE 9]>
        <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
      <![endif]-->
  <link href="theme/css/doxstyles.css" rel="stylesheet">
  <script src="jquery.js"></script>
  <script src="theme/bootstrap3/js/bootstrap.min.js"></script>
  <link href="theme/bootstrap3/css/bootstrap.min.css" rel="stylesheet">
  <link href="theme/bootstrap3/css/font-awesome.min.css" rel="stylesheet">
  <script src="theme/js/tocify/jquery.tocify.min.js"></script>
  <link href="theme/js/tocify/jquery.tocify.css" rel="stylesheet">
  <script src="theme/js/doxy-boot.js"></script>
  <script src="theme/js/application.js"></script>
  <script src="dynsections.js"></script>
  <link href="theme/css/syntax.css" rel="stylesheet">
  <link href="theme/css/style.css" rel="stylesheet">
  <script src="search/search.js"></script>
  <script src="search/searchdata.js"></script>
</head>
<body style="min-height: 200px; padding-top: 50px;">
<header class="navbar navbar-inverse navbar-fixed-top bs-docs-nav">
  <div class="container">
    <div class="row">
      <div class="col-md-offset-1 col-sm-offset-0 col-md-10">
        <div class="navbar-header">
          <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".menu-navbar-collapse">
            <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="index.html">wCMF 4.0</a>
        </div>
        <div class="collapse navbar-collapse menu-navbar-collapse" role="navigation">
          <ul class="nav navbar-nav">
            <li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="fa fa-hand-o-right"></i> Guides <b class="caret"></b></a>
              <ul class="dropdown-menu">
                <li><a href="gettingstarted.html">Getting started</a></li>
                <li><a href="architecture.html">Architecture</a></li>
                <li><a href="model.html">Model</a></li>
                <li><a href="persistence.html">Persistence</a></li>
                <li><a href="presentation.html">Presentation</a></li>
                <li><a href="configuration.html">Configuration</a></li>
                <li><a href="security.html">Security</a></li>
                <li><a href="i18n_l10n.html">I18n & l10n</a></li>
                <li><a href="tests.html">Tests</a></li>
              </ul>
            </li>
            <li class="dropdown"><a href="annotated.html"><i class="fa fa-file-text-o"></i> API</a></li>
            <li><a href="https://github.com/iherwig/wcmf"><i class="fa fa-github"></i> Code</a></li>
            <li><a href="support.html"><i class="fa fa-support"></i> Support</a></li>
          </ul>
          <ul class="nav navbar-nav pull-right">
            <li>
              <div id="MSearchBox">
                <input id="MSearchField" type="text" class="form-control" placeholder="Search API" name="query" onkeyup="searchBox.OnSearchFieldChange(event)">
              </div>
              <div id="MSearchSelect"></div>
              <div id="MSearchClose"></div>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</header>
<a class="anchor" id="top"></a>
<div class="content" id="content">
  <div class="container">
    <div class="row" style="margin-top: 20px;">
      <div class="col-md-offset-1 col-sm-offset-0 col-md-10 panel panel-default">
       <div>
<!-- end header part --><!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
//var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Model </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><div class="has-toc"></div><h1><a class="anchor" id="model_main"></a>
Model</h1>
<p>wCMF applications are based on a model. The model defines the key aspects of the application on a higher abstraction level than code does. You can think of it as a condensed description of the application.</p>
<p>A template based code generator transforms the model into source code that will run inside the wCMF framework. Where necessary, the code can then be enhanced manually inside pre-defined regions. Further generation runs will protect these manual additions.</p>
<p>We believe that this approach helps to develop a clear concept of the application and improves code quality and maintainability dramatically.</p>
<h2><a class="anchor" id="model_create"></a>
Modeling</h2>
<p>Technically the model is an <a href="http://en.wikipedia.org/wiki/Unified_Modeling_Language">UML</a> model that uses the <em>Chronos</em> <a href="http://en.wikipedia.org/wiki/Profile_%28UML%29">profile</a> from the <a href="http://sourceforge.net/projects/olympos/">Olympos</a> project. It is stored in an <a href="http://wiki.eclipse.org/MDT-UML2">Eclipse MDT/UML2</a> compatible XML file (e.g. <code>model.uml</code>). This file can be directly edited using <a href="http://www.eclipse.org/papyrus/">Eclipse Papyrus</a> or any other <a href="http://wiki.eclipse.org/MDT-UML2-Tool-Compatibility">compatible UML modeling tool</a>. Alternatively you can use the <a href="http://sourceforge.net/projects/olympos/">Chronos Web Modeler</a> that allows browser based collaborative modeling. wCMF uses a minimized version of the code generator from the Olympos project with wCMF specific templates.</p>
<p>The following diagram shows the workflow of the generator.</p>
<div class="image">
<img src="generator.png" alt="generator.png"/>
<div class="caption">
Generator workflow</div></div>
 <h3><a class="anchor" id="model_profile"></a>
Chronos profile</h3>
<p><em>Profiles</em> are used to extend UML for different domains. They consist of <b>stereotypes</b> and <b>tags</b> that are applied to model elements to express domain specific features. The following sections describe the stereotypes and tags of the <em>Chronos</em> profile that are used to define various aspects of a wCMF application. The complete <a href="https://raw.githubusercontent.com/iherwig/wcmf-default-app/master/model/chronos.profile.uml">Chronos profile</a> is available on GitHub.</p>
<p>You will notice that only a small part of UML is used to define the application and not all aspects of the application are defined in the model. Especially the actual behavior of controllers and domain classes is omitted, since we believe that this is more efficiently expressed in code. For simplicity and compatibility reasons all aspects can be modeled in <b>class diagrams</b> using <b>classes</b>, <b>attributes</b> and <b>associations</b>.</p>
<dl class="section note"><dt>Note</dt><dd>UML elements and concepts that are not mentioned in the following sections are most likely not supported by the generator and will be ignored.</dd></dl>
<h3><a class="anchor" id="model_classes"></a>
Domain classes</h3>
<p>The following <b>stereotypes</b> are used to model persistent domain classes and their relations.</p>
<table class="doxtable">
<tr>
<th>Name </th><th>UML meta class </th><th>Description </th><th>Example  </th></tr>
<tr>
<td><em>ChiNode</em> </td><td>Class </td><td>Persistent domain class, must inherit from the <a class="el" href="classwcmf_1_1lib_1_1model_1_1_node.html"><code>Node</code></a> </td><td><em>Article</em> </td></tr>
<tr>
<td><em>ChiValue</em> </td><td>Attribute </td><td>Persistent attribute in a <em>ChiNode</em> </td><td><em>headline</em> of Article </td></tr>
<tr>
<td><em>ChiValueRef</em> </td><td>Attribute </td><td>ReadOnly-reference to an attribute of another <em>ChiNode</em> </td><td><em>author_name</em> in Article references <em>name</em> in Author </td></tr>
<tr>
<td><em>ChiManyToMany</em> </td><td>Class </td><td>Connection class in a many to many relation between <em>ChiNode</em> classes, must inherit from <a class="el" href="classwcmf_1_1lib_1_1model_1_1_node.html"><code>Node</code></a> </td><td>One <em>Author</em> writes nultiple <em>Articles</em> and one <em>Article</em> has multiple <em>Authors</em> </td></tr>
<tr>
<td><em>ChiAssociation</em> </td><td>Association </td><td>Optional, e.g. used to define a foreign key name in a relation between <em>ChiNode</em> instances </td><td><em>author_id</em> in Article as foreign key to Author table </td></tr>
</table>
<h4><a class="anchor" id="model_chinode"></a>
ChiNode / ChiManyToMany</h4>
<p>The following <b>tags</b> are defined on the <em>ChiNode</em> / <em>ChiManyToMany</em> stereotypes.</p>
<table class="doxtable">
<tr>
<th>Tag </th><th>Description </th><th>Example </th><th>Default value  </th></tr>
<tr>
<td><em>initparams</em> </td><td>Name of the configuration section, which defines initialization parameters for the <a class="el" href="interfacewcmf_1_1lib_1_1persistence_1_1_persistence_mapper.html"><code>PersistenceMapper</code></a> instance </td><td><em>database</em> </td><td><em>database</em> </td></tr>
<tr>
<td><em>display_value</em> </td><td>Attributes to display in a list view: A single attribute name or |-separated list of attribute names </td><td><em>name|date</em> </td><td></td></tr>
<tr>
<td><em>orderby</em> </td><td>Definition of default sorting: <em>none</em> (no order), <em>sortkey</em> (generates a <em>sortkey</em> column, that is used for explicit sorting) or the name of any attribute optionally followed by <em>ASC</em> or <em>DESC</em> </td><td><em>name ASC</em> </td><td><em>none</em> </td></tr>
<tr>
<td><em>is_searchable</em> </td><td>Boolean, indicating whether this type should be included in the default search </td><td><em>true</em> </td><td><em>true</em> </td></tr>
<tr>
<td><em>is_soap</em> </td><td>Boolean, indicating whether this type should be exposed to the SOAP interface </td><td><em>true</em> </td><td><em>true</em> </td></tr>
<tr>
<td><em>table_name</em> </td><td>The name of the database table in which instances will be stored </td><td><em>Author</em> </td><td>Class name </td></tr>
<tr>
<td><em>pk_name</em> </td><td>The name of the primary key column: A single value or |-separated list of values (the generator will add this automatically, if there is no appropriate attribute) </td><td><em>fk_user_id|fk_role_id</em> </td><td><em>id</em> </td></tr>
<tr>
<td><em>child_order</em> </td><td>The order of the associated child types: A single type or |-separated list of types </td><td><em>Image|Textblock|Attachment</em> in Article type </td><td></td></tr>
<tr>
<td><em>parent_order</em> </td><td>The order of the associated parent types: A single type or |-separated list of types </td><td><em>Author|Publisher</em> in Article type </td><td></td></tr>
</table>
<dl class="section note"><dt>Note</dt><dd>Some of these tags are accessible in the application through the <a class="el" href="interfacewcmf_1_1lib_1_1persistence_1_1_persistent_object.html#aa54d71e15bac85c5f7a13e62b9933652"><code>PersistentObject::getProperty</code></a> method.</dd></dl>
<h4><a class="anchor" id="model_chivalue"></a>
ChiValue</h4>
<p>The following <b>tags</b> are defined on the <em>ChiValue</em> stereotype.</p>
<table class="doxtable">
<tr>
<th>Tag </th><th>Description </th><th>Example </th><th>Default value  </th></tr>
<tr>
<td><em>app_data_type</em> </td><td>Application specific attribute tags: A single value or |-separated list of values (see <a class="el" href="persistence.html#pers_values">Values, Properties and Tags</a>) </td><td><em>TAG_A|TAG_B</em> </td><td><em>DATATYPE_ATTRIBUTE</em> </td></tr>
<tr>
<td><em>db_data_type</em> </td><td>The attribute's database type </td><td><em>TEXT</em> </td><td><em>VARCHAR(255)</em> </td></tr>
<tr>
<td><em>is_editable</em> </td><td>Boolean, indicating whether this attribute is editable </td><td><em>true</em> </td><td><em>true</em> </td></tr>
<tr>
<td><em>input_type</em> </td><td>Name of the attribute's input control as listed in the <em>InputTypes</em> configuration section and additional configuration encoded as JSON string </td><td><em>filebrowser</em> or <em>ckeditor:{"toolbarSet":"full"}</em> </td><td><em>text</em> </td></tr>
<tr>
<td><em>display_type</em> </td><td>Name of the attribute's display type as listed in the <em>DisplayTypes</em> configuration section </td><td><em>image</em> </td><td><em>text</em> </td></tr>
<tr>
<td><em>restrictions_match</em> </td><td>Name of the attribute's validation type as listed in the <em>Validator</em> configuration section (see <a class="el" href="persistence.html#pers_validation">Validation</a>) and additional configuration encoded as JSON string </td><td><em>regexp:{"pattern":"^[0-9]*$"}</em> or <em>image:{"height":[300,0]}</em> </td><td></td></tr>
<tr>
<td><em>restrictions_not_match</em> </td><td><em>not used</em> </td><td></td><td></td></tr>
<tr>
<td><em>restrictions_description</em> </td><td>Validation description used in case of a validation error </td><td><em>The value must be an integer or empty</em> </td><td></td></tr>
<tr>
<td><em>column_name</em> </td><td>The name of the database column in which the attribute will be stored </td><td><em>name</em> </td><td>Attribute name </td></tr>
</table>
<dl class="section note"><dt>Note</dt><dd>Some of these tags are accessible in the application through the <a class="el" href="interfacewcmf_1_1lib_1_1persistence_1_1_persistent_object.html#a095af4f09e7aa62ba45e94a35c047c1d"><code>PersistentObject::getValueProperty</code></a> method.</dd></dl>
<h4><a class="anchor" id="model_chivalueref"></a>
ChiValueRef</h4>
<p>The following <b>tags</b> are defined on the <em>ChiValueRef</em> stereotype.</p>
<table class="doxtable">
<tr>
<th>Tag </th><th>Description </th><th>Example </th><th>Default value  </th></tr>
<tr>
<td><em>reference_type</em> </td><td>Type, that owns the referenced attribute </td><td><em>Author</em> </td><td></td></tr>
<tr>
<td><em>reference_value</em> </td><td>Name of the references attribute </td><td><em>name</em> </td><td></td></tr>
</table>
<h4><a class="anchor" id="model_association"></a>
ChiAssociation</h4>
<p>The following <b>tags</b> are defined on the <em>ChiAssociation</em> stereotype.</p>
<table class="doxtable">
<tr>
<th>Tag </th><th>Description </th><th>Example </th><th>Default value  </th></tr>
<tr>
<td><em>fk_name</em> </td><td>Name of the foreign key attribute (the generator will add this automatically, if there is no appropriate attribute) </td><td><em>author_id</em> </td><td><em>fk</em>_type_ <em>id</em> </td></tr>
</table>
<h4><a class="anchor" id="model_class_example"></a>
Example class diagram</h4>
<p>A simple data model is shown in the diagram below. Each of the domain classes <em>Author</em>, <em>Article</em> and <em>Image</em> is modeled with <em>ChiNode</em> stereotype, their attributes with <em>ChiValue</em> stereotype. The only exception is the <em>author_name</em> attribute, which is a reference to the <em>name</em> attribute of <em>Author</em> and therefore uses the stereotype <em>ChiValueRef</em>. As the relations between the classes show, one <em>Author</em> can own several <em>Articles</em> and each <em>Article</em> in turn can contain several <em>Images</em>.</p>
<p>All <a class="el" href="interfacewcmf_1_1lib_1_1persistence_1_1_persistence_mapper.html"><code>PersistenceMapper</code></a> instances are initialized using the parameters defined in the <em>database</em> configuration section.</p>
<p>In list views <em>Author</em> instances are sorted by <em>name</em> while <em>Article</em> and <em>Image</em> instances get an attribute <em>sortkey</em> which is used to define an explicit order.</p>
<div class="image">
<img src="model.png" alt="model.png"/>
<div class="caption">
Example class diagram</div></div>
 <h4><a class="anchor" id="model_associations"></a>
Associations</h4>
<p>Relations between domain classes - e.g. parent-child relations - are modeled as associations. Three different <b>types of associations</b> are supported: <em>compositions</em>, <em>aggregations</em> and <em>one-directional associations</em> as shown in the following diagram.</p>
<div class="image">
<img src="associations.png" alt="associations.png"/>
<div class="caption">
Association types</div></div>
<p> It is important to understand how wCMF recognizes <b>parents and children</b> in an association. In case of compositions and aggregations the parent is always the class, that is connected with the diamond end of the association. Other associations are treated as parent-child relation, if they are only navigable in one direction, which is then defined as the child to parent direction.</p>
<p>The association types differ in the treatment of children in case of <b>deletion</b> of the parent. In aggregations and normal associations children are not deleted, while composite children are deleted on parent deletion. On the other hand the <a class="el" href="gettingstarted.html#app">default application</a> allows <b>creation</b> of child instances in a composition, while the other two types only allow adding existing instances.</p>
<p>The following table summarizes the behavior of the different association types regarding the operations allowed on child instances:</p>
<table class="doxtable">
<tr>
<th>Association type </th><th>Delete children </th><th>Create children </th><th>Associate children  </th></tr>
<tr>
<td>Composition </td><td>Yes </td><td>Yes </td><td>No </td></tr>
<tr>
<td>Aggregation </td><td>No </td><td>Yes </td><td>Yes </td></tr>
<tr>
<td>Association </td><td>No </td><td>No </td><td>Yes </td></tr>
</table>
<h5>Multiplicity</h5>
<p>The multiplicity at the association ends limits the amount of instances that are allowed at that relation end. In a typical parent-child relation the parent end has a value of <code>1</code> and the child end has a value of <code>0..*</code> meaning that a child instance is connected to exactly one parent instance, while any number of child instances may be connected to the parent instance (including zero). This kind of relation is called <b>one-to-many relation</b> and is easy to realize in a database by using a <em>foreign key</em> column.</p>
<p><b>Many-to-many relations</b> on the other hand allow an arbitrary number of instances at both ends and are typically realized in an database using a <em>junction table</em>. The Chronos profile allows for this by providing the <code>ChiManyToMany</code> stereotype. The following diagram shows how to model a many-to-many relation:</p>
<div class="image">
<img src="many-to-many.png" alt="many-to-many.png"/>
<div class="caption">
Many-to-many relation</div></div>
<p> Using compositions ensures that many-to-many instances are deleted correctly, when the parent instances are deleted.</p>
<h5>Navigability</h5>
<p>Another aspect of associations is the use of <b>arrow ends</b> that define the navigability. If an arrow end is omitted on one end, instances at that end are not accessible from the other end. Regarding the database schema all three association types will result in the creation of a foreign key column in the child table that points to the parent table.</p>
<h5>Role names</h5>
<p>Each end of an association can have a <em>role name</em> assigned. It describes how the element at that end participates in the relation. Generally the role name defaults to the element's name, but there are two cases where it is necessary to assign a dedicated name:</p>
<ul>
<li><em>Multiple associations</em></li>
<li><em>Self associations</em></li>
</ul>
<p>Sometimes <b>multiple associations</b> have to be defined between two domain classes. For example if there are <code>Person</code> and <code>Task</code> domain classes and tasks should be associated with persons. If each task should have an owner and a creator, there will be two aggregations between the two domain classes. To allow wCMF to know which role a person has in relation to a given task, role names have to be assigned to the association ends.</p>
<p>The following diagram illustrates the given example:</p>
<div class="image">
<img src="multiple-associations.png" alt="multiple-associations.png"/>
<div class="caption">
Role names in multiple associations</div></div>
<p> To build a hierarchy where one item contains items of the same type, an association from the domain class to itself is required. An example would be a file system with nested directories. In this case, role names are required at each end of this <b>self association</b>.</p>
<p>The following diagram illustrates the given example:</p>
<div class="image">
<img src="self-associations.png" alt="self-associations.png"/>
<div class="caption">
Role names in self associations</div></div>
 <h4><a class="anchor" id="model_inheritance"></a>
Inheritance</h4>
<p>If different domain classes should have the same attributes, a common base class can make these available to inheriting classes. An example may be an <code>EntityBase</code> type, which defines meta information like creation date and last modification date for all domain classes. The diagram below illustrates the concept.</p>
<div class="image">
<img src="inheritance.png" alt="inheritance.png"/>
<div class="caption">
Inheritance</div></div>
<p> Inheritance will cause the generator to create new relations in the following cases:</p>
<div class="image-table"> <table class="doxtable">
<tr>
<th>Parent relations </th><th>Child relations  </th></tr>
<tr>
<td><div class="image">
<img src="inherited-relation1.png" alt="inherited-relation1.png"/>
<div class="caption">
Subclass B becomes parent of A</div></div>
 </td><td><div class="image">
<img src="inherited-relation3.png" alt="inherited-relation3.png"/>
<div class="caption">
Subclass B becomes child of A</div></div>
</td></tr>
<tr>
<td><div class="image">
<img src="inherited-relation2.png" alt="inherited-relation2.png"/>
<div class="caption">
Parent class of B becomes parent of A</div></div>
 </td><td><div class="image">
<img src="inherited-relation4.png" alt="inherited-relation4.png"/>
<div class="caption">
Child class of B becomes child of A</div></div>
</td></tr>
</table>
</div><h3><a class="anchor" id="model_flow"></a>
Application flow</h3>
<p>Since a wCMF application is based on the Model-View-Controller pattern, application flow is defined in terms of <em>controllers</em> and <em>views</em>. Controller execution is triggered by <em>actions</em> which are initiated by the application user.</p>
<p>The following <b>stereotypes</b> are used to model user interaction.</p>
<table class="doxtable">
<tr>
<th>Name </th><th>UML meta class </th><th>Description </th><th>Example  </th></tr>
<tr>
<td><em>ChiController</em> </td><td>Class </td><td>Controller class, must inherit from the <a class="el" href="classwcmf_1_1lib_1_1presentation_1_1_controller.html"><code>Controller</code></a> </td><td><em>LoginController</em> </td></tr>
<tr>
<td><em>ChiView</em> </td><td>Class </td><td>View assigned to a <em>ChiController</em> </td><td><em>login</em> </td></tr>
<tr>
<td><em>ChiActionKey</em> </td><td>Association </td><td>Associates two <em>ChiController</em> instances (to define a control flow) or a <em>ChiView</em> with a <em>ChiController</em> (to define a view attachment), must be <em>one directional</em> </td><td></td></tr>
</table>
<dl class="section note"><dt>Note</dt><dd><em>ChiActionKey</em> realizes the concept of <em>action keys</em> (see <a class="el" href="architecture.html#arch_actionkey">Action Key</a>). Multiple action keys may be defined between controllers or controllers and views each one used in a different context and/or for a different action.</dd></dl>
<h4><a class="anchor" id="model_chicontroller"></a>
ChiController</h4>
<p>No <b>tags</b> are defined on the <em>ChiController</em> stereotype.</p>
<h4><a class="anchor" id="model_chiview"></a>
ChiView</h4>
<p>No <b>tags</b> are defined on the <em>ChiView</em> stereotype.</p>
<h4><a class="anchor" id="model_chiactionkey"></a>
ChiActionKey</h4>
<p>The following <b>tags</b> are defined on the <em>ChiActionKey</em> stereotype.</p>
<table class="doxtable">
<tr>
<th>Tag </th><th>Description </th><th>Example </th><th>Default value  </th></tr>
<tr>
<td><em>action</em> </td><td>The action, which is triggered by this association. If empty, any action is valid </td><td><em>save</em> </td><td></td></tr>
<tr>
<td><em>context</em> </td><td>The context, in which this association is valid. If empty, any context is valid </td><td><em>author</em> </td><td></td></tr>
<tr>
<td><em>config</em> </td><td>The configuration, in which this association is defined </td><td><em>config.ini</em> </td><td><em>config.ini</em> </td></tr>
</table>
<h4><a class="anchor" id="model_example_flow"></a>
Example application flow</h4>
<p>An example for a simple interaction model is given in the diagram below. The controllers are modeled with the stereotype <em>ChiController</em>, the associations with <em>ChiActionKey</em> stereotype. Each association's tagged values are displayed in an attached note. Since the association between <em>AuthorController</em> and <em>author</em> view does not define the tagged values <em>action</em> and <em>context</em>, <em>AuthorController</em> displays this view for every action and context. The same applies to <em>ArticleController</em> and the <em>article</em> view. <em>SaveController</em> does not display a view, it only stores the data passed to it and returns to the next controller.</p>
<p>For associations, which link controllers, at least the tagged value <em>action</em> is set. Since obviously all <em>save</em> actions result in the execution of <em>SaveController</em>, no context is necessary. The context is helpful, when we want to solve the ambiguousness of the action <em>ok</em> upon termination of <em>SaveController</em>. We define, that the context is <em>author</em> when editing the author and <em>article</em> when editing articles. By this the application always knows to which controller it should return to after executing <em>SaveController</em>.</p>
<div class="image">
<img src="flow.png" alt="flow.png"/>
<div class="caption">
Example application flow</div></div>
 <dl class="section note"><dt>Note</dt><dd>If the <em>controller</em> value of the action key should be empty, meaning that the action can be triggered from <em>any</em> controller, the source of the <em>ChiActionKey</em> association must be the <a class="el" href="classwcmf_1_1lib_1_1presentation_1_1_controller.html"><code>Controller</code></a> base class.</dd></dl>
<h4><a class="anchor" id="model_controller_methods"></a>
Controller methods</h4>
<p>By default the framework calls the method <em>doExecute</em> on the current controller instance for any <em>context</em> and <em>action</em> value. For this reason an empty implementation of this method will be added by the generator.</p>
<p>To distinguish different actions or contexts it is also possible to model several operations inside the controller class. To connect an action key to a controller method, the action key's end that points to the controller must be named like the method. The following diagram illustrates the concept:</p>
<div class="image">
<img src="controller-methods.png" alt="controller-methods.png"/>
<div class="caption">
Controller methods</div></div>
 <h3><a class="anchor" id="model_config"></a>
Configuration</h3>
<p>The following <b>stereotypes</b> are used to model the application configuration.</p>
<table class="doxtable">
<tr>
<th>Name </th><th>UML meta class </th><th>Description </th><th>Example  </th></tr>
<tr>
<td><em>ChiSystem</em> </td><td>Class </td><td>A configuration section, class members and their default values become key-value pairs inside the section </td><td><em>Database</em> </td></tr>
</table>
<h4><a class="anchor" id="model_chisystem"></a>
ChiSystem</h4>
<p>The following <b>tags</b> are defined on the <em>ChiSystem</em> stereotype.</p>
<table class="doxtable">
<tr>
<th>Tag </th><th>Description </th><th>Example </th><th>Default value  </th></tr>
<tr>
<td><em>platform</em> </td><td>The platform to which the configuration settings apply </td><td><em>wcmf</em> </td><td></td></tr>
<tr>
<td><em>config</em> </td><td>The configuration, in which the settings are defined </td><td><em>config.ini</em> </td><td><em>config.ini</em> </td></tr>
</table>
<h4><a class="anchor" id="model_example_config"></a>
Example configuration</h4>
<p>The following diagram shows the configuration of a database connection. The connection parameters can be accessed later using the <a class="el" href="interfacewcmf_1_1lib_1_1config_1_1_configuration.html#a69b8f6a56f006f65cdfdb8a8884eb420"><code>Configuration::getSection</code></a> method and passing <em>database</em> as <code>section</code> paramter.</p>
<div class="image">
<img src="config.png" alt="config.png"/>
<div class="caption">
Example configuration</div></div>
 <h3><a class="anchor" id="model_default"></a>
Default model</h3>
<p>The <a class="el" href="gettingstarted.html#app">default application</a> inlcudes a demo UML model located in <code>model/model.uml</code>. It is a good starting point for own experiments. For those who want to start from scratch there are also base models in <em>model/base/cwm/</em> (for <a href="http://sourceforge.net/projects/olympos/">Chronos Web Modeler</a>) and <em>model/base/papyrus/</em> (for <a href="http://www.eclipse.org/papyrus/">Eclipse Papyrus</a>).</p>
<p>The default model has the following package structure:</p>
<ul>
<li><em>model</em><ul>
<li><em>wcmf test</em><ul>
<li><em>Primitive types</em></li>
<li><em>root</em><ul>
<li><b>configuration</b> Application specific configuration<ul>
<li><em>default</em><ul>
<li><em>config.ini</em><ul>
<li><code>«ChiSystem» Config</code></li>
<li>...</li>
</ul>
</li>
<li>...</li>
</ul>
</li>
</ul>
</li>
<li><em>wcmf</em> Framework packages with useful (base-)classes<ul>
<li><em>application</em><ul>
<li><em>controller</em> Existing controllers<ul>
<li><code>«ChiController» AssociateController</code></li>
<li>...</li>
</ul>
</li>
</ul>
</li>
<li><em>lib</em><ul>
<li><em>presentation</em><ul>
<li><code>«ChiController» Controller</code> Base class for all controller classes</li>
</ul>
</li>
<li><em>model</em><ul>
<li><code>«ChiNode» Node</code> Base class for all domain classes</li>
</ul>
</li>
<li><em>security</em><ul>
<li><em>principal</em><ul>
<li><em>impl</em><ul>
<li><code>AbstractUser</code> Base class for custom user class</li>
<li><code>AbstractRole</code> Base class for custom role class</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><em>app</em> Application specific packages<ul>
<li><em>src</em><ul>
<li><b>model</b> Domain class package<ul>
<li><em>wcmf</em> Default framework classes<ul>
<li><code>«ChiNode» DBSequence</code></li>
<li>...</li>
</ul>
</li>
<li><code>«ChiNode» EntityBase</code> Base class for domain classes with audit info</li>
<li>...</li>
</ul>
</li>
<li><b>controller</b> Controller package<ul>
<li><code>«ChiController» RootController</code> Main controller of <a class="el" href="gettingstarted.html#app">default application</a></li>
</ul>
</li>
<li><b>views</b> Views package<ul>
<li><code>«ChiView» cms</code> Main view of <a class="el" href="gettingstarted.html#app">default application</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Application specific model elements will mostly reside in the <b>emphasized</b> packages.</p>
<h2><a class="anchor" id="model_generator"></a>
Generator</h2>
<p>wCMF uses the code generator from the <a href="http://sourceforge.net/projects/olympos/">Olympos</a> project which is originally based on <em>openArchitectureWare</em>. The generator is a JAVA application that executes user defined workflows. Workflows are organized in cartridges one of which is the wCMF cartridge. Cartridges are written in the <em>Xtent/Xpand</em> language.</p>
<p>If you are using <a href="https://getcomposer.org/">Composer</a>, the generator will be installed as a dependency in the directory <em>vendor/olympos/chronos-generator</em>. It may also be downloaded from <a href="https://sourceforge.net/projects/olympos/files/ChronosGenerator-wCMF/">SourceForge</a>.</p>
<h3><a class="anchor" id="generator_config"></a>
Configuration</h3>
<p>The configuration of the generator is stored as key-value pairs in a file called <code>workflow.properties</code> in the <em>model</em> directory. It contains the following <b>variables</b>:</p>
<table class="doxtable">
<tr>
<th>Variable </th><th>Description </th><th>Default value  </th></tr>
<tr>
<td><em>profilename</em> </td><td>Name of the used UML profile </td><td><em>Chronos</em> </td></tr>
<tr>
<td><em>profileUmlFile</em> </td><td>Path to the profile file </td><td><em>${basePath}/metamodel/chronos.profile.uml</em> </td></tr>
<tr>
<td><em>modelUmlFile</em> </td><td>Model file to generate code from </td><td><em>model.uml</em> </td></tr>
<tr>
<td><em>transformedModelUmlFile</em> </td><td>Location for the model transformed into the generator's internal format (used for debug purposes) </td><td><em>model-transformed</em> </td></tr>
<tr>
<td><em>rootPackage</em> </td><td>Model package containing <em>libraryPackage</em> and <em>applicationPackage</em>. It's name will be stripped from paths to classes </td><td><em>wcmf test::root</em> </td></tr>
<tr>
<td><em>libraryPackage</em> </td><td>Model package, in which the wCMF framework is defined. From this package no files will be generated </td><td><em>wcmf</em> </td></tr>
<tr>
<td><em>applicationPackage</em> </td><td>Model package, in which the application is modeled </td><td><em>app</em> </td></tr>
<tr>
<td><em>doCheck</em> </td><td>Indicates whether the generator should run checks on the model </td><td><em>true</em> </td></tr>
<tr>
<td><em>preCheckFile</em> </td><td>Check file, that should be used before the transformation into the internal model format </td><td><em>cartridge::Wcmf::checks::pre</em> </td></tr>
<tr>
<td><em>postCheckFile</em> </td><td>Check file, that should be used after the transformation into the internal model format </td><td><em>cartridge::Wcmf::checks::post</em> </td></tr>
<tr>
<td><em>requiredControllerSuperclass</em> </td><td>Controller base class, from which all controllers must inherit, used in the checks </td><td><em>model::${rootPackage}::${libraryPackage}::lib::presentation::Controller</em> </td></tr>
<tr>
<td><em>requiredNodeSuperclass</em> </td><td>Domain base class, from which all domain classes must inherit, used in the checks </td><td><em>model::${rootPackage}::${libraryPackage}::lib::model::Node</em> </td></tr>
<tr>
<td><em>doBackup</em> </td><td>Indicates whether the generator should do a backup of the application, before generating any files </td><td><em>false</em> </td></tr>
<tr>
<td><em>expand</em> </td><td>Template definition to start the generation from </td><td><em>cartridge::Wcmf::templates::Root::root</em> </td></tr>
<tr>
<td><em>outputEncoding</em> </td><td>Encoding of the generated files </td><td><em>UTF-8</em> </td></tr>
<tr>
<td><em>configFileDefault</em> </td><td>Name of the default configuration file, general properties like type mapping are declared here </td><td><em>config.ini</em> </td></tr>
<tr>
<td><em>projectname</em> </td><td>Name of the application </td><td><em>wcmf testapp</em> </td></tr>
<tr>
<td><em>targetDir</em> </td><td>Directory, in which the application is created </td><td><em>targetDir</em> </td></tr>
<tr>
<td><em>prExcludes</em> </td><td>File patterns to be excluded when searching for protected regions </td><td><em>*.svn-base, .git, vendor</em> </td></tr>
<tr>
<td><em>printGenerateDate</em> </td><td>Indicates whether the generation date should be printed in generated file headers </td><td><em>false</em> </td></tr>
<tr>
<td><em>headerText</em> </td><td>Text to be prepended to generated files </td><td></td></tr>
</table>
<p>The variables <code>${basePath}</code> (generator location) and <code>${targetDir}</code> (generated code location) must be provided as <b>command line</b> arguments when running the generator (see <a class="el" href="model.html#generator_run">Running</a>).</p>
<h3><a class="anchor" id="generator_run"></a>
Running</h3>
<p>The generator is started using the <b>command</b></p>
<pre>
java -Djava.library.path=<b><em>libPath</em></b> -jar ChronosGenerator.jar <b><em>workflowFile</em></b> -basePath=<b><em>basePath</em></b> -propertyFile=<b><em>propertyFile</em></b> -targetDir=<b><em>targetDir</em></b>
</pre><p>The <b>parameters</b> are explained in the following table.</p>
<table class="doxtable">
<tr>
<th>Parameter </th><th>Description </th><th>Default value  </th></tr>
<tr>
<td><em>libPath</em> </td><td>Path to the generator libraries </td><td><em>../vendor/olympos/chronos-generator/lib</em> </td></tr>
<tr>
<td><em>workflowFile</em> </td><td>Workflow definition file </td><td><em>../vendor/olympos/chronos-generator/cartridge/Wcmf/workflow/wcmf.oaw</em> </td></tr>
<tr>
<td><em>basePath</em> </td><td>Path to the generator installation </td><td><em>../vendor/olympos/chronos-generator/</em> </td></tr>
<tr>
<td><em>propertyFile</em> </td><td>Workflow configuration file </td><td><em>../model/workflow.properties</em> </td></tr>
<tr>
<td><em>targetDir</em> </td><td>Path to the generated files </td><td><em>../</em> </td></tr>
</table>
<p>The <b>default values</b> apply, if the generator is run from the <em>build</em> directory of the <a class="el" href="gettingstarted.html#app">default application</a>.</p>
<p>Since the code generator is integrated into the <b>ant deployment script</b> of the application, it's also sufficient to run the following command in the <em>build</em> directory:</p>
<pre>
ant generate
</pre><h3><a class="anchor" id="generator_artefacts"></a>
Artefacts</h3>
<p>The generator creates the following files:</p>
<h4><a class="anchor" id="generator_artefacts_config"></a>
Configuration</h4>
<ul>
<li><b>SQL scripts</b> are generated in the <em>install</em> directory. They contain the table definitions for <a href="http://www.mysql.com">MySQL</a> databases (<code>install/tables_mysql.sql</code>) and <a href="https://sqlite.org">SQLite</a> databases (<code>install/tables_sqlite.sql</code>). For each domain class one table is created, inherited attributes are stored in each table (<a href="http://martinfowler.com/eaaCatalog/concreteTableInheritance.html">Concrete Table Inheritance</a>).</li>
<li><b>Configuration files</b> in the <a href="http://en.wikipedia.org/wiki/INI_file">INI file</a> format are generated in the <em>app/config</em> directory. Configuration files are implicitly defined in the model by the <code>ChiActionKey.config</code> and <code>ChiSystem.config</code> tags. For each name mentioned in these tags, one configuration file will be created, containing all definitions related to it. Furthermore, the default configuration file (<em>config.ini</em> per default) contains the domain class mapping definitions.</li>
</ul>
<h4><a class="anchor" id="generator_artefacts_php"></a>
PHP Code</h4>
<ul>
<li><b>Mapper classes</b> are generated in directories corresponding to the model packages (<em>app/src/model</em>, if the default model packages are used). For each <code>ChiNode</code>/<code>ChiManyToMany</code> class one subclass of <a class="el" href="classwcmf_1_1lib_1_1model_1_1mapper_1_1_node_unified_r_d_b_mapper.html"><code>NodeUnifiedRDBMapper</code></a> is created (e.g. <code>AuthorRDBMapper</code>).</li>
<li><b>Domain classes</b> are generated in the same directories as the mapper classes. For each <code>ChiNode</code>/<code>ChiManyToMany</code> class two classes are created, one base class that contains all generated code (e.g. <code>AuthorBase</code>) and one empty subclass, that is used to add custom code (e.g. <code>Author</code>). The base class inherits from <a class="el" href="classwcmf_1_1lib_1_1model_1_1_node.html"><code>Node</code></a> or one of it's subclasses.</li>
<li><b>Controller classes</b> are generated in directories corresponding to the model packages (<em>app/src/controller</em>, if the default model packages are used). For each <code>ChiController</code> class one subclass of <a class="el" href="classwcmf_1_1lib_1_1presentation_1_1_controller.html"><code>Controller</code></a> will be created.</li>
<li>The <b>SOAP interface</b> is generated in the file <em>app/public/soap-interface.php</em>. <a class="el" href="classwcmf_1_1application_1_1controller_1_1_s_o_a_p_controller.html"><code>SOAPController</code></a> uses this file to configure the <a class="el" href="classwcmf_1_1lib_1_1service_1_1_soap_server.html"><code>SoapServer</code></a>.</li>
</ul>
<h4><a class="anchor" id="generator_artefacts_tpl"></a>
Template Code</h4>
<ul>
<li><b>View templates</b> are generated in directories corresponding to the model packages (<em>app/src/views</em>, if the default model packages are used). For each <code>ChiView</code> class one empty template file will be created.</li>
</ul>
<h4><a class="anchor" id="generator_artefacts_js"></a>
JavaScript Code</h4>
<ul>
<li><b>Domain classes</b> are generated in a subdirectory of <em>public/js</em> (<em>app/public/js/app/src/model</em>, if the default model packages are used). For each <code>ChiNode</code>/<code>ChiManyToMany</code> one subclass of <code>Entity</code> is created.</li>
<li>An <a href="http://en.wikipedia.org/wiki/Asynchronous_module_definition">AMD</a> file referencing all domain classes is created in <em>public/js/model</em> (<em>app/public/js/model/_TypeList.js</em>, if the default model packages are used).</li>
</ul>
<h4><a class="anchor" id="generator_pr"></a>
Protected regions</h4>
<p>The generator creates functional code, but of course <b>custom code</b> must be added to implement domain specific functionality. For this reason the generator adds sections that are enclosed in <code>PROTECTED REGION</code> tags, between which the user is supposed to place custom code. When re-generating the code later (e.g. because of model changes), this custom code will be preserved.</p>
<p>An example of a class file containing protected regions is shown below.</p>
<div class="fragment"><div class="line">&lt;?php<span class="comment"></span></div>
<div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment">   This file was generated by ChronosGenerator  from model.uml.</span></div>
<div class="line"><span class="comment">   Manual modifications should be placed inside the protected regions.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">namespace </span>app\src\model;</div>
<div class="line"></div>
<div class="line">use app\src\model\AuthorBase;</div>
<div class="line"><span class="comment">// PROTECTED REGION ID(app/src/model/Author.php/Import) ENABLED START</span></div>
<div class="line"><span class="comment">// PROTECTED REGION END</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment">   Author description:</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">   @author</span></div>
<div class="line"><span class="comment">   @version 1.0</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">class </span>Author <span class="keyword">extends</span> AuthorBase {</div>
<div class="line"><span class="comment">// PROTECTED REGION ID(app/src/model/Author.php/Body) ENABLED START</span></div>
<div class="line"><span class="comment">// PROTECTED REGION END</span></div>
<div class="line">}</div>
<div class="line">?&gt;</div>
</div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
      </div>
    </div>
  </div>
</div>
<hr>
<footer>
  <div class="container">
    <div class="row">
      <div class="col-md-9">
        <small>&copy; 2016 <a href="http://www.wemove.com" target="_blank">wemove digital solutions</a><br>
          Generated on Fri Jul 15 2016 22:20:41 for wCMF by &#160;<a href="http://www.doxygen.org/index.html" target="_blank">doxygen</a> 1.8.10</small>
      </div>
    </div>
  </div>
</footer>
</body>
</html>
