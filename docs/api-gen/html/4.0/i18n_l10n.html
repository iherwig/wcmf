<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>wCMF 4.0: I18n &amp; l10n</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="A MDSD framework for building reliable, maintainable and extendable web applications with PHP">
  <meta name="keywords" content="PHP, web application framework, model driven development">
  <meta name="author" content="wemove digital solutions">
  <link rel="shortcut icon" href="theme/images/favicon.ico">
  <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
  <!--[if lt IE 9]>
        <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
      <![endif]-->
  <link href="theme/css/doxstyles.css" rel="stylesheet">
  <script src="jquery.js"></script>
  <script src="theme/bootstrap3/js/bootstrap.min.js"></script>
  <link href="theme/bootstrap3/css/bootstrap.min.css" rel="stylesheet">
  <link href="theme/bootstrap3/css/font-awesome.min.css" rel="stylesheet">
  <script src="theme/js/tocify/jquery.tocify.min.js"></script>
  <link href="theme/js/tocify/jquery.tocify.css" rel="stylesheet">
  <script src="theme/js/doxy-boot.js"></script>
  <script src="theme/js/application.js"></script>
  <script src="dynsections.js"></script>
  <link href="theme/css/syntax.css" rel="stylesheet">
  <link href="theme/css/style.css" rel="stylesheet">
  <script src="search/search.js"></script>
  <script src="search/searchdata.js"></script>
</head>
<body style="min-height: 200px; padding-top: 50px;">
<header class="navbar navbar-inverse navbar-fixed-top bs-docs-nav">
  <div class="container">
    <div class="row">
      <div class="col-md-offset-1 col-sm-offset-0 col-md-10">
        <div class="navbar-header">
          <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".menu-navbar-collapse">
            <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="index.html">wCMF 4.0</a>
        </div>
        <div class="collapse navbar-collapse menu-navbar-collapse" role="navigation">
          <ul class="nav navbar-nav">
            <li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="fa fa-hand-o-right"></i> Guides <b class="caret"></b></a>
              <ul class="dropdown-menu">
                <li><a href="gettingstarted.html">Getting started</a></li>
                <li><a href="architecture.html">Architecture</a></li>
                <li><a href="model.html">Model</a></li>
                <li><a href="persistence.html">Persistence</a></li>
                <li><a href="presentation.html">Presentation</a></li>
                <li><a href="configuration.html">Configuration</a></li>
                <li><a href="security.html">Security</a></li>
                <li><a href="i18n_l10n.html">I18n & l10n</a></li>
                <li><a href="tests.html">Tests</a></li>
              </ul>
            </li>
            <li class="dropdown"><a href="annotated.html"><i class="fa fa-file-text-o"></i> API</a></li>
            <li><a href="https://github.com/iherwig/wcmf"><i class="fa fa-github"></i> Code</a></li>
            <li><a href="support.html"><i class="fa fa-support"></i> Support</a></li>
          </ul>
          <ul class="nav navbar-nav pull-right">
            <li>
              <div id="MSearchBox">
                <input id="MSearchField" type="text" class="form-control" placeholder="Search API" name="query" onkeyup="searchBox.OnSearchFieldChange(event)">
              </div>
              <div id="MSearchSelect"></div>
              <div id="MSearchClose"></div>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</header>
<a class="anchor" id="top"></a>
<div class="content" id="content">
  <div class="container">
    <div class="row" style="margin-top: 20px;">
      <div class="col-md-offset-1 col-sm-offset-0 col-md-10 panel panel-default">
       <div>
<!-- end header part --><!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
//var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">I18n &amp; l10n </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><div class="has-toc"></div><h1><a class="anchor" id="i18n_main"></a>
Internationalization &amp; localization</h1>
<p><em>Internationalization</em> of an application requires to identify all language dependent resources and make them exchangeable for the actual <em>localization</em> into a specific language. This includes <b>static</b> and <b>dynamic texts</b> as well as <b>images</b>. Since images are referenced by their filename or represented as text (e.g. <em>base64</em> encoded), it is sufficient to focus on text.</p>
<h2><a class="anchor" id="i18n_static"></a>
Static text</h2>
<p>Static text refers to text used in <b>application templates</b> or <b>messages</b> generated while the application is executed. To keep the application code language agnostic only so called <em>text identifiers</em> are used in these places and the actual translation is retrieved by calling the <a class="el" href="interfacewcmf_1_1lib_1_1i18n_1_1_message.html#aef9e1ab491290cf4f519d25c96043dbb"><code>Message::getText</code></a> method:</p>
<div class="fragment"><div class="line">$textId = <span class="stringliteral">&#39;An error occured&#39;</span>;</div>
<div class="line"></div>
<div class="line"><span class="comment">// retrieve the translation</span></div>
<div class="line"><a class="code" href="namespacewcmf_1_1lib_1_1presentation.html#abf17cb2dba2ed17cb28aa5f37deb5293">$message</a> = ObjectFactory::getInstance(<span class="stringliteral">&#39;Message&#39;</span>);</div>
<div class="line">$errorText = <a class="code" href="namespacewcmf_1_1lib_1_1presentation.html#abf17cb2dba2ed17cb28aa5f37deb5293">$message</a>-&gt;getText($textId);</div>
<div class="line"></div>
<div class="line"><span class="comment">// use the translation</span></div>
<div class="line">$ex = <span class="keyword">new</span> <a class="code" href="namespace_exception.html">Exception</a>($errorText);</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>Implementations of <a class="el" href="interfacewcmf_1_1lib_1_1i18n_1_1_message.html"><code>Message</code></a> must return the <em>text identifier</em>, if no translation is found or the translation is empty. This helps to simplify the translation process, if the default language is used in <em>text identifiers</em>. In this case, no translation is required for the default language.</dd></dl>
<p>If no language parameter is passed to the <a class="el" href="interfacewcmf_1_1lib_1_1i18n_1_1_message.html#aef9e1ab491290cf4f519d25c96043dbb"><code>Message::getText</code></a> method, the returned translation will be in the application's <b>default user interface language</b>. This language is determined in the following way:</p>
<ol type="1">
<li>Use the value of the <code>language</code> parameter of the <code>Message</code> configuration section</li>
<li>If not defined use the value of the global variable <code>$_SERVER['HTTP_ACCEPT_LANGUAGE']</code></li>
</ol>
<p>If parts of the text vary depending on the application state, it is necessary to put <b>variables</b> into the text identifier. Variable names are <code>%0%</code>, <code>%1%</code>, ... and they are replaced in the order of the values passed into the <a class="el" href="interfacewcmf_1_1lib_1_1i18n_1_1_message.html#aef9e1ab491290cf4f519d25c96043dbb"><code>Message::getText</code></a> method:</p>
<div class="fragment"><div class="line">$textId = <span class="stringliteral">&#39;Logged in as %0% since %1%&#39;</span>;</div>
<div class="line">$parameters = array($username, $date);</div>
<div class="line"></div>
<div class="line"><span class="comment">// retrieve the translation</span></div>
<div class="line"><a class="code" href="namespacewcmf_1_1lib_1_1presentation.html#abf17cb2dba2ed17cb28aa5f37deb5293">$message</a> = ObjectFactory::getInstance(<span class="stringliteral">&#39;Message&#39;</span>);</div>
<div class="line">$loginMessage = <a class="code" href="namespacewcmf_1_1lib_1_1presentation.html#abf17cb2dba2ed17cb28aa5f37deb5293">$message</a>-&gt;getText($textId, $parameters);</div>
<div class="line"></div>
<div class="line"><span class="comment">// use the translation</span></div>
<div class="line">$view-&gt;setValue(<span class="stringliteral">&#39;loginMessage&#39;</span>, $loginMessage);</div>
</div><!-- fragment --><h3><a class="anchor" id="i18n_static_tpl"></a>
Template text</h3>
<p>wCMF provides the <code>translate</code> plugin for embedding language dependent text into <em>Smarty</em> templates. The plugin is automatically included and used in the following way:</p>
<div class="fragment"><div class="line">{translate text=<span class="stringliteral">&quot;An error occured&quot;</span>}</div>
<div class="line"></div>
<div class="line">{* with variables *}</div>
<div class="line">{translate text=<span class="stringliteral">&quot;Logged in as %0% since %1%&quot;</span> r0=$login r1=$logindate}</div>
</div><!-- fragment --><h3><a class="anchor" id="i18n_static_locale"></a>
Localization</h3>
<p>Since <a class="el" href="interfacewcmf_1_1lib_1_1i18n_1_1_message.html"><code>Message</code></a> defines the interface, it needs concrete implementations to actually get the translations. The <a class="el" href="classwcmf_1_1lib_1_1i18n_1_1impl_1_1_file_message.html"><code>FileMessage</code></a> class retrieves translations from the file system. It expects one file per language defining a language dependent array that maps text identifiers to translations. The language code (e.g. <em>en</em>) is used to identify the language of the translation. The file must be named like <em>messages_</em>code.<em>php</em>, the variable like <em>$messages_</em>code.</p>
<p>The following <b>examples</b> show definitions for English (<em>en</em>) and German (<em>de</em>) texts, where the array keys are the text identifiers used in the application and the values are the translations in the appropriate language.</p>
<p><em>messages_en.php</em></p>
<div class="fragment"><div class="line">$messages_en = array();</div>
<div class="line">$messages_en[<span class="stringliteral">&#39;%0% selected&#39;</span>] = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line">$messages_en[<span class="stringliteral">&#39;Author&#39;</span>] = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line">$messages_en[<span class="stringliteral">&#39;Book&#39;</span>] = <span class="stringliteral">&#39;&#39;</span>;</div>
</div><!-- fragment --><p><em>messages_de.php</em></p>
<div class="fragment"><div class="line">$messages_de = array();</div>
<div class="line">$messages_de[<span class="stringliteral">&#39;%0% selected&#39;</span>] = <span class="stringliteral">&#39;%0% ausgewählt&#39;</span>;</div>
<div class="line">$messages_de[<span class="stringliteral">&#39;Author&#39;</span>] = <span class="stringliteral">&#39;Autor&#39;</span>;</div>
<div class="line">$messages_de[<span class="stringliteral">&#39;Book&#39;</span>] = <span class="stringliteral">&#39;Buch&#39;</span>;</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>Note that the text identifiers are in the application's default language (<em>en</em>) and therefor no translations need to be provided.</dd></dl>
<p>The default <b>configuration</b> of <a class="el" href="interfacewcmf_1_1lib_1_1i18n_1_1_message.html"><code>Message</code></a> is as follows:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;[Message]</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;__class = wcmf\lib\i18n\impl\FileMessage</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;localeDir = app/locale/</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;language = en</div>
</div><!-- fragment --><p>The parameter <code>localeDir</code> defines the directory where <a class="el" href="classwcmf_1_1lib_1_1i18n_1_1impl_1_1_file_message.html"><code>FileMessage</code></a> searchs for translation files and the <code>language</code> parameter defines the application's default language.</p>
<h3><a class="anchor" id="i18n_static_tools"></a>
Tools</h3>
<p>The <a class="el" href="gettingstarted.html#app">default application</a> ships with a tool for finding translatable text and generating localization files from it. After installing the application it is available under <code><a href="http://localhost/wcmf-default-app/tools/locale/">http://localhost/wcmf-default-app/tools/locale/</a></code>.</p>
<p>The tool uses <a class="el" href="classwcmf_1_1lib_1_1util_1_1_i18n_util.html"><code>I18nUtil</code></a> internally to search for occurrences of</p>
<ul>
<li><code>-&gt;getText('Text to translate', ...)</code> as used in <code>$message-&gt;getText('Text to translate', ...)</code> in PHP code</li>
<li><code>{translate:"Text to translate" ...}</code> as used in Smarty templates</li>
<li><code>Dict.translate("Text to translate", ...)</code> as used in the Javascript code of the <a class="el" href="gettingstarted.html#app">default application</a></li>
</ul>
<p><em>Text to translate</em> is supposed to be the message to be localized. The tool generates one localization file for each language puts it into the appropriate directory. It's capable of merging already existing translations into the newly generated files.</p>
<p>The tool's configuration is defined in the file <em>config.ini</em> in the tool's directory and defaults to:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;[Application]</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;localeDir = app/locale/</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;[I18n]</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;searchDirs = {vendor/wcmf/wcmf/src/wcmf, app/}</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;exclude = {vendor, .git, .svn, test}</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;languages = {de, en}</div>
</div><!-- fragment --><h2><a class="anchor" id="i18n_dynamic"></a>
Model content</h2>
<p>Model content is initially created in the application's <b>default model language</b>, which might differ from the <em>default user interface language</em> (see <a class="el" href="i18n_l10n.html#i18n_static">Static text</a>). Localization of the model content is done by using implementations of <a class="el" href="interfacewcmf_1_1lib_1_1i18n_1_1_localization.html"><code>Localization</code></a>. The interface defines methods for loading and saving localized model content. The following code demonstrates how to use it to get translated content:</p>
<div class="fragment"><div class="line">$oid = <span class="keyword">new</span> ObjectId(<span class="stringliteral">&#39;Book&#39;</span>, 1);</div>
<div class="line"></div>
<div class="line"><span class="comment">// retrieve a localized entity instance</span></div>
<div class="line">$localization = ObjectFactory::getInstance(<span class="stringliteral">&#39;localization&#39;</span>);</div>
<div class="line">$bookDe = $localization-&gt;loadTranslatedObject($oid, <span class="stringliteral">&#39;de&#39;</span>);</div>
</div><!-- fragment --><h3><a class="anchor" id="i18n_dynamic_locale"></a>
Localization</h3>
<p>There are several strategies for storing localized versions of the content, all having advantages and disadvantages regarding extensibility and performance. The idea behind the <a class="el" href="classwcmf_1_1lib_1_1i18n_1_1impl_1_1_default_localization.html"><code>DefaultLocalization</code></a> implementation is to keep the domain model clear of localization related attributes by storing translations in a separate entity type. Using one entity type for all content leads to more flexibility when extending the domain model.</p>
<p>The <b>translation entity type</b> must have the following attributes:</p>
<ul>
<li><code>objectid</code> object id of the translated entity (e.g. <em>Book:1</em>)</li>
<li><code>attribute</code> translated attribute (e.g. <em>title</em>)</li>
<li><code>language</code> the language code of the translation (e.g. <em>en</em>)</li>
<li><code>translation</code> the actual translation</li>
</ul>
<p>The supported content languages are either defined in the <code>Languages</code> configuration section (see below) or in the language entity type that is used by <a class="el" href="classwcmf_1_1lib_1_1i18n_1_1impl_1_1_default_localization.html"><code>DefaultLocalization</code></a>, if the configuration section does not exist.</p>
<p>The <b>language entity type</b> must have the following attributes:</p>
<ul>
<li><code>code</code> language code (e.g. <em>en</em>)</li>
<li><code>name</code> language name (e.g. <em>English</em>)</li>
</ul>
<p>The following <b>example</b> demonstrates the creation of localized content using the <a class="el" href="interfacewcmf_1_1lib_1_1i18n_1_1_localization.html"><code>Localization</code></a> interface:</p>
<div class="fragment"><div class="line">$oid = <span class="keyword">new</span> ObjectId(<span class="stringliteral">&#39;Book&#39;</span>, 1);</div>
<div class="line"></div>
<div class="line"><span class="comment">// retrieve the original entity instance</span></div>
<div class="line">$persistenceFacade = ObjectFactory::getInstance(<span class="stringliteral">&#39;persistenceFacade&#39;</span>);</div>
<div class="line">$book = $persistenceFacade-&gt;load($oid);</div>
<div class="line"></div>
<div class="line"><span class="comment">// localize the instance</span></div>
<div class="line">$book-&gt;setValue(<span class="stringliteral">&#39;title&#39;</span>, <span class="stringliteral">&#39;Übersetzter Titel&#39;</span>);</div>
<div class="line"></div>
<div class="line"><span class="comment">// save the translation</span></div>
<div class="line">$localization = ObjectFactory::getInstance(<span class="stringliteral">&#39;localization&#39;</span>);</div>
<div class="line">$localization-&gt;saveTranslation($book, <span class="stringliteral">&#39;de&#39;</span>);</div>
</div><!-- fragment --><p>The localization <b>configuration</b> of the <a class="el" href="gettingstarted.html#app">default application</a> is the following:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;[Localization]</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;__class = wcmf\lib\i18n\impl\DefaultLocalization</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;defaultLanguage = en</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;languageType = app.src.model.wcmf.Language</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;translationType = app.src.model.wcmf.Translation</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;[Languages]</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;de = Deutsch</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;en = English</div>
</div><!-- fragment --><p>In this example the <em>default model language</em> is set to English and the <em>language entity type</em> is ignored, because the available languages are defined in the configuration. </p>
</div></div><!-- contents -->
<!-- start footer part -->
      </div>
    </div>
  </div>
</div>
<hr>
<footer>
  <div class="container">
    <div class="row">
      <div class="col-md-9">
        <small>&copy; 2016 <a href="http://www.wemove.com" target="_blank">wemove digital solutions</a><br>
          Generated on Fri Jul 15 2016 22:20:41 for wCMF by &#160;<a href="http://www.doxygen.org/index.html" target="_blank">doxygen</a> 1.8.10</small>
      </div>
    </div>
  </div>
</footer>
</body>
</html>
