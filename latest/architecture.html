<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>wCMF 4.1: Architecture</title>
  <meta name="generator" content="Doxygen 1.8.17"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="A MDSD framework for building reliable, maintainable and extendable web applications with PHP">
  <meta name="keywords" content="PHP, web application framework, model driven development">
  <meta name="author" content="wemove digital solutions">
  <link rel="shortcut icon" href="theme/images/favicon.ico">
  <script src="jquery.js"></script>
  <script src="theme/vendor/popper/popper.min.js"></script>
  <script src="theme/vendor/bootstrap/js/bootstrap.min.js"></script>
  <link href="theme/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="theme/vendor/fontawesome/css/all.min.css" rel="stylesheet">
  <script src="theme/vendor/bootstrap-toc/bootstrap-toc.min.js"></script>
  <link href="theme/vendor/bootstrap-toc/bootstrap-toc.min.css" rel="stylesheet">
  <script src="theme/vendor/bootstrap3-typeahead/bootstrap3-typeahead.min.js"></script>
  <script src="theme/vendor/highlight/highlight.pack.js"></script>
  <link href="theme/vendor/highlight/styles/solarized-dark.css" rel="stylesheet">
  <script src="theme/js/application.js"></script>
  <script src="dynsections.js"></script>
  <link href="theme/css/style.css" rel="stylesheet">
</head>
<body data-spy="scroll" data-target="#toc">
<nav class="navbar navbar-expand-lg navbar-dark bg-dark sticky-top">
  <a class="navbar-brand" href="index.html">wCMF 4.1</a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarToggler" aria-controls="navbarToggler" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse" id="navbarToggler">
    <ul class="navbar-nav mr-auto mt-2 mt-lg-0">
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" id="guidesDropdownMenuLink" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          <i class="far fa-hand-point-right"></i> Guides <b class="caret"></b>
        </a>
        <div class="dropdown-menu" aria-labelledby="guidesDropdownMenuLink">
          <a class="dropdown-item" href="gettingstarted.html">Getting started</a>
          <a class="dropdown-item" href="architecture.html">Architecture</a>
          <a class="dropdown-item" href="model.html">Model</a>
          <a class="dropdown-item" href="persistence.html">Persistence</a>
          <a class="dropdown-item" href="presentation.html">Presentation</a>
          <a class="dropdown-item" href="configuration.html">Configuration</a>
          <a class="dropdown-item" href="security.html">Security</a>
          <a class="dropdown-item" href="i18n_l10n.html">I18n & l10n</a>
          <a class="dropdown-item" href="tests.html">Tests</a>
        </div>
      </li>
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" id="versionsDropdownMenuLink" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          <i class="fas fa-tags"></i> Versions <b class="caret"></b>
        </a>
        <div class="dropdown-menu" aria-labelledby="versionsDropdownMenuLink">
          <a class="dropdown-item" href="4.1/index.html">4.1.x</a>
          <a class="dropdown-item" href="4.0/index.html">4.0.x</a>
        </div>
      </li>
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" id="apiDropdownMenuLink" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          <i class="fas fa-file-alt"></i> API <b class="caret"></b>
        </a>
        <div class="dropdown-menu" aria-labelledby="apiDropdownMenuLink">
          <a class="dropdown-item" href="annotated.html">Classes</a>
          <a class="dropdown-item" href="hierarchy.html">Hierarchy</a>
        </div>
      </li>
      <li class="nav-item"><a class="nav-link" href="https://github.com/iherwig/wcmf"><i class="fab fa-github"></i> Code</a></li>
      <li class="nav-item"><a class="nav-link" href="support.html"><i class="fas fa-life-ring"></i> Support</a></li>
    </ul>
    <form class="form-inline my-2 my-lg-0">
      <input id="search-field" class="form-control mr-sm-2" type="search" placeholder="Search API" disabled>
    </form>
  </div>
</nav>
<a class="anchor" id="top"></a>
<div class="content" id="content">
  <div class="container">
    <div class="row mt-4">
      <div id="toc-container" class="col-lg-3 d-none d-lg-block d-none">
        <nav id="toc" class="sticky-top"></nav>
      </div>
      <div id="content-container" class="col-md-12 col-lg-12">
        <div>
<!-- end header part --><!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
//var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Architecture </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><div class="has-toc"></div><h1><a class="anchor" id="arch_main"></a>
Architecture</h1>
<p>The main architectural concept of wCMF is the well known <a href="http://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93controller">Model-View-Controller</a> pattern. The following sections describe it's implementation in wCMF and introduce some other key concepts, that are useful to know when using the framework.</p>
<h2><a class="anchor" id="arch_model"></a>
Model</h2>
<p>An application is usually based on a <em>domain model</em> that represents the real-world concepts of the domain of interest. In object oriented programming this model is implemented using classes. Depending on the application requirements the instances of some of these classes have to be persisted in a storage to keep the contained data. These classes represent the <em>data model</em>. The classes that provide the infrastructure for storing data form the <em>persistence layer</em>.</p>
<p>wCMF defines <a class="el" href="interfacewcmf_1_1lib_1_1persistence_1_1_persistent_object.html"><code>PersistentObject</code></a> as base class for persistent domain classes. It mainly implements an unique identifier for each instance (see <a class="el" href="architecture.html#arch_oid">Object Identifier</a>), tracking of the persistent state, methods for setting and getting values as well as callback methods for lifecycle events. For the composition of object graphs the derived class <a class="el" href="classwcmf_1_1lib_1_1model_1_1_node.html"><code>Node</code></a> is used as base class. It implements relation support for persistent objects.</p>
<p>To retrieve persisted objects <a class="el" href="interfacewcmf_1_1lib_1_1persistence_1_1_persistence_facade.html"><code>PersistenceFacade</code></a> is used. The actual operations for creating, reading, updating and deleting objects (e.g. SQL commands) are defined in classes implementing the <a class="el" href="interfacewcmf_1_1lib_1_1persistence_1_1_persistence_mapper.html"><code>PersistenceMapper</code></a> interface (see <a href="http://martinfowler.com/eaaCatalog/dataMapper.html">Data Mapper Pattern</a>). Although not necessary there usually exists one mapper class for each persistent domain class. Mapper classes are introduced to the persistent facade by configuration.</p>
<div class="image">
<img src="persistence.png" alt=""/>
<div class="caption">
Persistence layer</div></div>
<p>Please refer to the section <a class="el" href="persistence.html">Persistence</a> for a more detailed description of the persistence layer.</p>
<h3><a class="anchor" id="arch_oid"></a>
Object Identifier</h3>
<p>For handling lots of different domain objects an unique identification is crucial. To achieve this, so-called <em>Object Identifiers</em> (<em>OID</em> or <em>object id</em>) are used. Various strategies are possible to obtain these identifiers, e.g. a central registry.</p>
<p>wCMF composes these object ids from the type of the persistent domain class and a number, which is unique for each type (e.g. <em>Author::1</em>). It is important that the object's type can be derived from the object id, because this enables the <a class="el" href="interfacewcmf_1_1lib_1_1persistence_1_1_persistence_facade.html"><code>PersistenceFacade</code></a> to determine the <a class="el" href="interfacewcmf_1_1lib_1_1persistence_1_1_persistence_mapper.html"><code>PersistenceMapper</code></a> for the given object from the configuration. The class <a class="el" href="classwcmf_1_1lib_1_1persistence_1_1_object_id.html"><code>ObjectId</code></a> implements this concept.</p>
<h2><a class="anchor" id="arch_presentation"></a>
Presentation</h2>
<p>The <em>presentation layer</em> of a wCMF application enables users to interact with the domain model.</p>
<p>Each interaction is initiated by a <em>request</em> and results in a <em>response</em>. In a web application the request data is sent by the user's browser to the server as GET, POST, etc. variables.</p>
<p>wCMF's <a class="el" href="classwcmf_1_1lib_1_1presentation_1_1_application.html"><code>Application</code></a> class transforms the request data into a <a class="el" href="interfacewcmf_1_1lib_1_1presentation_1_1_request.html"><code>Request</code></a> instance. This instance is then passed to a <a class="el" href="interfacewcmf_1_1lib_1_1presentation_1_1_action_mapper.html"><code>ActionMapper</code></a> instance, which creates the <a class="el" href="interfacewcmf_1_1lib_1_1presentation_1_1_response.html"><code>Response</code></a> instance and delegates the actual execution of the request to a <a class="el" href="classwcmf_1_1lib_1_1presentation_1_1_controller.html"><code>Controller</code></a> instance. Different controllers exist for different actions (e.g. <a class="el" href="classwcmf_1_1application_1_1controller_1_1_list_controller.html"><code>ListController</code></a> for listing objects, <a class="el" href="classwcmf_1_1application_1_1controller_1_1_search_controller.html"><code>SearchController</code></a> for searching objects).</p>
<p>The controller is determined by matching specific request parameters against a list of so called <em>action keys</em> (see <a class="el" href="architecture.html#arch_actionkey">Action Key</a>). As the result of it's execution each controller returns action key parameters in the response data. If these parameters match an existing action key, the associated controller will be executed by passing the current response as input. In this way complex tasks can be executed by chaining several controller calls together.</p>
<p>To support various data representations, a <a class="el" href="interfacewcmf_1_1lib_1_1presentation_1_1format_1_1_format.html"><code>Format</code></a> instance is associated with each request and response. The format is automatically determined by the HTTP <em>Content-Type</em> resp. <em>Accept</em> headers. <a class="el" href="interfacewcmf_1_1lib_1_1presentation_1_1format_1_1_format.html"><code>Format</code></a> implementations are responsible for de-/serializing the request and response data into the desired format (e.g. <em>JSON</em> or <em>SOAP</em>). <a class="el" href="classwcmf_1_1lib_1_1presentation_1_1format_1_1impl_1_1_html_format.html"><code>HtmlFormat</code></a> especially uses a <a class="el" href="interfacewcmf_1_1lib_1_1presentation_1_1view_1_1_view.html"><code>View</code></a> instance to render the response data into a HTML page. wCMF's uses <a href="http://www.smarty.net/">Smarty</a> as the default template engine for HTML output.</p>
<div class="image">
<img src="presentation.png" alt=""/>
<div class="caption">
Presentation layer</div></div>
<p>Please refer to the section <a class="el" href="presentation.html">Presentation</a> for a more detailed description of the presentation layer.</p>
<h3><a class="anchor" id="arch_actionkey"></a>
Action Key</h3>
<p>An important concept of wCMF is that of <em>Action Keys</em>. An action key describes the state of the application together with the <b>action</b> to be performed next. The state, which the application is in, results from the current <b>controller</b> and the <b>context</b>, in which it is executed. Controllers must exist as classes, whereas contexts and actions can be arbitrary strings.</p>
<p>The string representation of an action key is as follows:</p>
<div class="ini"> <div class="fragment"><div class="line">controller?context?action</div>
</div><!-- fragment --></div><div class="ini"></div><dl class="section note"><dt>Note</dt><dd>Since question marks (?) are used to separate the parts of an action key, a question mark is not allowed inside the parts itself.</dd></dl>
<p>wCMF uses action keys in the following places:</p>
<ol type="1">
<li>In <b>routing definitions</b> controller names are assigned to action keys. <a class="el" href="interfacewcmf_1_1lib_1_1presentation_1_1_action_mapper.html"><code>ActionMapper</code></a> uses these definitions to execute the correct controller when the application is in a certain state.</li>
<li>In <b>view definitions</b> template filenames are assigned to action keys. <a class="el" href="interfacewcmf_1_1lib_1_1presentation_1_1view_1_1_view.html"><code>View</code></a> determines the view template to be displayed for the current application state.</li>
<li>In <b>permission definitions</b> roles are assigned to action keys. In this case the controller value of the action key is interpreted as resource and can also define an entity type or entity instance. <a class="el" href="interfacewcmf_1_1lib_1_1security_1_1_permission_manager.html"><code>PermissionManager</code></a> uses this when checking permissions on a given resource.</li>
</ol>
<p>Since parts of the action key can be omitted in the definition, an algorithm has to choose, which action key fits a given value triple best. This algorithm is implemented in the method <a class="el" href="classwcmf_1_1lib_1_1config_1_1_action_key.html#a2207aa22c775177bfb7947b342f4312a"><code>ActionKey::getBestMatch</code></a>. It checks action key lists against the following search values until a match is found:</p>
<div class="ini"> <div class="fragment"><div class="line">1. controller?context?action</div>
<div class="line">2. controller??action</div>
<div class="line">3. controller?context?</div>
<div class="line">4. ?context?action</div>
<div class="line">5. ??action</div>
<div class="line">6. controller??</div>
<div class="line">7. ?context?</div>
</div><!-- fragment --></div><div class="ini"></div><p>As a rule of thumb the action key which describes the state of the application the most accurate is favored.</p>
<p><b>Examples:</b></p>
<p>The following examples are taken from the <code>ActionMapping</code> configuration section, which defines which <a class="el" href="classwcmf_1_1lib_1_1presentation_1_1_controller.html"><code>Controller</code></a> to execute for a given action key (see <a class="el" href="presentation.html#pres_routingint">Internal routing</a>).</p>
<p>Always execute <a class="el" href="classwcmf_1_1application_1_1controller_1_1_save_controller.html"><code>SaveController</code></a> when action <em>update</em> is requested, no matter which state the application is in:</p>
<div class="ini"> <div class="fragment"><div class="line">??update = wcmf\application\controller\SaveController</div>
</div><!-- fragment --></div><div class="ini"></div><p>Always execute <code>AuthorController</code> when the application context is <em>author</em> as long as no action is specified:</p>
<div class="ini"> <div class="fragment"><div class="line">?author? = app\src\controller\AuthorController</div>
</div><!-- fragment --></div><div class="ini"></div> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
      </div>
    </div>
  </div>
</div>
<hr>
<footer>
  <div class="container">
    <div class="row">
      <div class="col-md-9">
        <small>&copy; 2020 <a href="http://www.wemove.com" target="_blank">wemove digital solutions</a><br>
          Generated on Mon Dec 21 2020 22:40:28 for wCMF by &#160;<a href="http://www.doxygen.org/index.html" target="_blank">doxygen</a> 1.8.17</small>
      </div>
    </div>
  </div>
</footer>
<!-- Matomo -->
<script type="text/javascript">
  var _paq = _paq || [];
  /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="https://piwik.wemove.com/";
    _paq.push(['setTrackerUrl', u+'piwik.php']);
    _paq.push(['setSiteId', '7']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<noscript><img src="https://piwik.wemove.com/piwik.php?idsite=7&rec=1" style="border:0" alt="" /></noscript>
<!-- End Matomo -->
</body>
</html>
