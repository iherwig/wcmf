<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>wCMF 4.1: I18n &amp; l10n</title>
  <meta name="generator" content="Doxygen 1.8.17"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="A MDSD framework for building reliable, maintainable and extendable web applications with PHP">
  <meta name="keywords" content="PHP, web application framework, model driven development">
  <meta name="author" content="wemove digital solutions">
  <link rel="shortcut icon" href="theme/images/favicon.ico">
  <script src="jquery.js"></script>
  <script src="theme/vendor/popper/popper.min.js"></script>
  <script src="theme/vendor/bootstrap/js/bootstrap.min.js"></script>
  <link href="theme/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="theme/vendor/fontawesome/css/all.min.css" rel="stylesheet">
  <script src="theme/vendor/bootstrap-toc/bootstrap-toc.min.js"></script>
  <link href="theme/vendor/bootstrap-toc/bootstrap-toc.min.css" rel="stylesheet">
  <script src="theme/vendor/bootstrap3-typeahead/bootstrap3-typeahead.min.js"></script>
  <script src="theme/vendor/highlight/highlight.pack.js"></script>
  <link href="theme/vendor/highlight/styles/solarized-dark.css" rel="stylesheet">
  <script src="theme/js/application.js"></script>
  <script src="dynsections.js"></script>
  <link href="theme/css/style.css" rel="stylesheet">
</head>
<body data-spy="scroll" data-target="#toc">
<nav class="navbar navbar-expand-lg navbar-dark bg-dark sticky-top">
  <a class="navbar-brand" href="index.html">wCMF 4.1</a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarToggler" aria-controls="navbarToggler" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse" id="navbarToggler">
    <ul class="navbar-nav mr-auto mt-2 mt-lg-0">
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" id="guidesDropdownMenuLink" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          <i class="far fa-hand-point-right"></i> Guides <b class="caret"></b>
        </a>
        <div class="dropdown-menu" aria-labelledby="guidesDropdownMenuLink">
          <a class="dropdown-item" href="gettingstarted.html">Getting started</a>
          <a class="dropdown-item" href="architecture.html">Architecture</a>
          <a class="dropdown-item" href="model.html">Model</a>
          <a class="dropdown-item" href="persistence.html">Persistence</a>
          <a class="dropdown-item" href="presentation.html">Presentation</a>
          <a class="dropdown-item" href="configuration.html">Configuration</a>
          <a class="dropdown-item" href="security.html">Security</a>
          <a class="dropdown-item" href="i18n_l10n.html">I18n & l10n</a>
          <a class="dropdown-item" href="tests.html">Tests</a>
        </div>
      </li>
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" id="versionsDropdownMenuLink" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          <i class="fas fa-tags"></i> Versions <b class="caret"></b>
        </a>
        <div class="dropdown-menu" aria-labelledby="versionsDropdownMenuLink">
          <a class="dropdown-item" href="4.1/index.html">4.1.x</a>
          <a class="dropdown-item" href="4.0/index.html">4.0.x</a>
        </div>
      </li>
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" id="apiDropdownMenuLink" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          <i class="fas fa-file-alt"></i> API <b class="caret"></b>
        </a>
        <div class="dropdown-menu" aria-labelledby="apiDropdownMenuLink">
          <a class="dropdown-item" href="annotated.html">Classes</a>
          <a class="dropdown-item" href="hierarchy.html">Hierarchy</a>
        </div>
      </li>
      <li class="nav-item"><a class="nav-link" href="https://github.com/iherwig/wcmf"><i class="fab fa-github"></i> Code</a></li>
      <li class="nav-item"><a class="nav-link" href="support.html"><i class="fas fa-life-ring"></i> Support</a></li>
    </ul>
    <form class="form-inline my-2 my-lg-0">
      <input id="search-field" class="form-control mr-sm-2" type="search" placeholder="Search API" disabled>
    </form>
  </div>
</nav>
<a class="anchor" id="top"></a>
<div class="content" id="content">
  <div class="container">
    <div class="row mt-4">
      <div id="toc-container" class="col-lg-3 d-none d-lg-block d-none">
        <nav id="toc" class="sticky-top"></nav>
      </div>
      <div id="content-container" class="col-md-12 col-lg-12">
        <div>
<!-- end header part --><!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
//var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">I18n &amp; l10n </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><div class="has-toc"></div><h1><a class="anchor" id="i18n_main"></a>
Internationalization &amp; localization</h1>
<p><em>Internationalization</em> of an application requires to identify all language dependent resources and make them exchangeable for the actual <em>localization</em> into a specific language. This includes <b>static</b> and <b>dynamic texts</b> as well as <b>images</b>. Since images are referenced by their filename or represented as text (e.g. <em>base64</em> encoded), it is sufficient to focus on text.</p>
<h2><a class="anchor" id="i18n_static"></a>
Static text</h2>
<p>Static text refers to text used in <b>application templates</b> or <b>messages</b> generated while the application is executed. To keep the application code language agnostic only so called <em>text identifiers</em> are used in these places and the actual translation is retrieved by calling the <a class="el" href="interfacewcmf_1_1lib_1_1i18n_1_1_message.html#aef9e1ab491290cf4f519d25c96043dbb"><code>Message::getText</code></a> method:</p>
<div class="php"> <div class="fragment"><div class="line">$textId = <span class="stringliteral">&#39;An error occured&#39;</span>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// retrieve the translation</span></div>
<div class="line">$message = ObjectFactory::getInstance(<span class="stringliteral">&#39;Message&#39;</span>);</div>
<div class="line">$errorText = $message-&gt;getText($textId);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// use the translation</span></div>
<div class="line">$ex = <span class="keyword">new</span> Exception($errorText);</div>
</div><!-- fragment --></div><div class="php"></div><dl class="section note"><dt>Note</dt><dd>Implementations of <a class="el" href="interfacewcmf_1_1lib_1_1i18n_1_1_message.html"><code>Message</code></a> must return the <em>text identifier</em>, if no translation is found or the translation is empty. This helps to simplify the translation process, if the default language is used in <em>text identifiers</em>. In this case, no translation is required for the default language.</dd></dl>
<p>If no language parameter is passed to the <a class="el" href="interfacewcmf_1_1lib_1_1i18n_1_1_message.html#aef9e1ab491290cf4f519d25c96043dbb"><code>Message::getText</code></a> method, the returned translation will be in the application's <b>default user interface language</b>. This language is determined in the following way:</p>
<ol type="1">
<li>Use the value of the <code>language</code> parameter of the <code>Message</code> configuration section</li>
<li>If not defined use the value of the global variable <code>$_SERVER['HTTP_ACCEPT_LANGUAGE']</code></li>
</ol>
<p>If parts of the text vary depending on the application state, it is necessary to put <b>variables</b> into the text identifier. Variable names are <code>%0%</code>, <code>%1%</code>, ... and they are replaced in the order of the values passed into the <a class="el" href="interfacewcmf_1_1lib_1_1i18n_1_1_message.html#aef9e1ab491290cf4f519d25c96043dbb"><code>Message::getText</code></a> method:</p>
<div class="php"> <div class="fragment"><div class="line">$textId = <span class="stringliteral">&#39;Logged in as %0% since %1%&#39;</span>;</div>
<div class="line">$parameters = [$username, $date];</div>
<div class="line"> </div>
<div class="line"><span class="comment">// retrieve the translation</span></div>
<div class="line">$message = ObjectFactory::getInstance(<span class="stringliteral">&#39;Message&#39;</span>);</div>
<div class="line">$loginMessage = $message-&gt;getText($textId, $parameters);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// use the translation</span></div>
<div class="line">$view-&gt;setValue(<span class="stringliteral">&#39;loginMessage&#39;</span>, $loginMessage);</div>
</div><!-- fragment --></div><div class="php"></div><h3><a class="anchor" id="i18n_static_tpl"></a>
Template text</h3>
<p>wCMF provides the <code>translate</code> plugin for embedding language dependent text into <em>Smarty</em> templates. The plugin is automatically included and used in the following way:</p>
<div class="php"> <div class="fragment"><div class="line">{translate text=<span class="stringliteral">&quot;An error occured&quot;</span>}</div>
<div class="line"> </div>
<div class="line">{* with variables *}</div>
<div class="line">{translate text=<span class="stringliteral">&quot;Logged in as %0% since %1%&quot;</span> r0=$login r1=$logindate}</div>
</div><!-- fragment --></div><div class="php"></div><h3><a class="anchor" id="i18n_static_locale"></a>
Localization</h3>
<p>Since <a class="el" href="interfacewcmf_1_1lib_1_1i18n_1_1_message.html"><code>Message</code></a> defines the interface, it needs concrete implementations to actually get the translations. The <a class="el" href="classwcmf_1_1lib_1_1i18n_1_1impl_1_1_file_message.html"><code>FileMessage</code></a> class retrieves translations from the file system. It expects one file per language defining a language dependent array that maps text identifiers to translations. The language code (e.g. <em>en</em>) is used to identify the language of the translation. The file must be named like <em>messages_</em>code.<em>php</em>, the variable like <em>$messages_</em>code.</p>
<p>The following <b>examples</b> show definitions for English (<em>en</em>) and German (<em>de</em>) texts, where the array keys are the text identifiers used in the application and the values are the translations in the appropriate language.</p>
<p><em>messages_en.php</em></p>
<div class="php"> <div class="fragment"><div class="line">$messages_en = [];</div>
<div class="line">$messages_en[<span class="stringliteral">&#39;%0% selected&#39;</span>] = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line">$messages_en[<span class="stringliteral">&#39;Author&#39;</span>] = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line">$messages_en[<span class="stringliteral">&#39;Book&#39;</span>] = <span class="stringliteral">&#39;&#39;</span>;</div>
</div><!-- fragment --></div><div class="php"></div><p><em>messages_de.php</em></p>
<div class="php"> <div class="fragment"><div class="line">$messages_de = [];</div>
<div class="line">$messages_de[<span class="stringliteral">&#39;%0% selected&#39;</span>] = <span class="stringliteral">&#39;%0% ausgewählt&#39;</span>;</div>
<div class="line">$messages_de[<span class="stringliteral">&#39;Author&#39;</span>] = <span class="stringliteral">&#39;Autor&#39;</span>;</div>
<div class="line">$messages_de[<span class="stringliteral">&#39;Book&#39;</span>] = <span class="stringliteral">&#39;Buch&#39;</span>;</div>
</div><!-- fragment --></div><div class="php"></div><dl class="section note"><dt>Note</dt><dd>Note that the text identifiers are in the application's default language (<em>en</em>) and therefor no translations need to be provided.</dd></dl>
<p>The default <b>configuration</b> of <a class="el" href="interfacewcmf_1_1lib_1_1i18n_1_1_message.html"><code>Message</code></a> is as follows:</p>
<div class="ini"> <div class="fragment"><div class="line">[Message]</div>
<div class="line">__class = wcmf\lib\i18n\impl\FileMessage</div>
<div class="line">localeDir = app/locale/</div>
<div class="line">language = en</div>
</div><!-- fragment --></div><div class="ini"></div><p>The parameter <code>localeDir</code> defines the directory where <a class="el" href="classwcmf_1_1lib_1_1i18n_1_1impl_1_1_file_message.html"><code>FileMessage</code></a> searchs for translation files and the <code>language</code> parameter defines the application's default language.</p>
<h3><a class="anchor" id="i18n_static_tools"></a>
Tools</h3>
<p>The <a class="el" href="gettingstarted.html#app">default application</a> ships with a tool for finding translatable text and generating localization files from it. After installing the application it is available under <code><a href="http://localhost/wcmf-default-app/tools/locale/">http://localhost/wcmf-default-app/tools/locale/</a></code>.</p>
<p>The tool uses <a class="el" href="classwcmf_1_1lib_1_1util_1_1_i18n_util.html"><code>I18nUtil</code></a> internally to search for occurrences of</p>
<ul>
<li><code>-&gt;getText('Text to translate', ...)</code> as used in <code>$message-&gt;getText('Text to translate', ...)</code> in PHP code</li>
<li><code>{translate:"Text to translate" ...}</code> as used in Smarty templates</li>
<li><code>Dict.translate("Text to translate", ...)</code> as used in the Javascript code of the <a class="el" href="gettingstarted.html#app">default application</a></li>
</ul>
<p><em>Text to translate</em> is supposed to be the message to be localized. The tool generates one localization file for each language puts it into the appropriate directory. It's capable of merging already existing translations into the newly generated files.</p>
<p>The tool's configuration is defined in the file <em>config.ini</em> in the tool's directory and defaults to:</p>
<div class="ini"> <div class="fragment"><div class="line">[Application]</div>
<div class="line">localeDir = app/locale/</div>
<div class="line"> </div>
<div class="line">[I18n]</div>
<div class="line">searchDirs = {vendor/<a class="code" href="namespacewcmf.html">wcmf</a>/<a class="code" href="namespacewcmf.html">wcmf</a>/src/<a class="code" href="namespacewcmf.html">wcmf</a>, app/}</div>
<div class="line">exclude = {vendor, .git, .svn, test}</div>
<div class="line">languages = {de, en}</div>
</div><!-- fragment --></div><div class="ini"></div><h2><a class="anchor" id="i18n_dynamic"></a>
Model content</h2>
<p>Model content is initially created in the application's <b>default model language</b>, which might differ from the <em>default user interface language</em> (see <a class="el" href="i18n_l10n.html#i18n_static">Static text</a>). Localization of the model content is done by using implementations of <a class="el" href="interfacewcmf_1_1lib_1_1i18n_1_1_localization.html"><code>Localization</code></a>. The interface defines methods for loading and saving localized model content. The following code demonstrates how to use it to get translated content:</p>
<div class="php"> <div class="fragment"><div class="line">$oid = <span class="keyword">new</span> ObjectId(<span class="stringliteral">&#39;Book&#39;</span>, 1);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// retrieve a localized entity instance</span></div>
<div class="line">$localization = ObjectFactory::getInstance(<span class="stringliteral">&#39;localization&#39;</span>);</div>
<div class="line">$bookDe = $localization-&gt;loadTranslatedObject($oid, <span class="stringliteral">&#39;de&#39;</span>);</div>
</div><!-- fragment --></div><div class="php"></div><h3><a class="anchor" id="i18n_dynamic_locale"></a>
Localization</h3>
<p>There are several strategies for storing localized versions of the content, all having advantages and disadvantages regarding extensibility and performance. The idea behind the <a class="el" href="classwcmf_1_1lib_1_1i18n_1_1impl_1_1_default_localization.html"><code>DefaultLocalization</code></a> implementation is to keep the domain model clear of localization related attributes by storing translations in a separate entity type. Using one entity type for all content leads to more flexibility when extending the domain model.</p>
<p>The <b>translation entity type</b> must have the following attributes:</p>
<ul>
<li><code>objectid</code> object id of the translated entity (e.g. <em>Book:1</em>)</li>
<li><code>attribute</code> translated attribute (e.g. <em>title</em>)</li>
<li><code>language</code> the language code of the translation (e.g. <em>en</em>)</li>
<li><code>translation</code> the actual translation</li>
</ul>
<p>The supported content languages are either defined in the <code>Languages</code> configuration section (see below) or in the language entity type that is used by <a class="el" href="classwcmf_1_1lib_1_1i18n_1_1impl_1_1_default_localization.html"><code>DefaultLocalization</code></a>, if the configuration section does not exist.</p>
<p>The <b>language entity type</b> must have the following attributes:</p>
<ul>
<li><code>code</code> language code (e.g. <em>en</em>)</li>
<li><code>name</code> language name (e.g. <em>English</em>)</li>
</ul>
<p>The following <b>example</b> demonstrates the creation of localized content using the <a class="el" href="interfacewcmf_1_1lib_1_1i18n_1_1_localization.html"><code>Localization</code></a> interface:</p>
<div class="php"> <div class="fragment"><div class="line">$oid = <span class="keyword">new</span> ObjectId(<span class="stringliteral">&#39;Book&#39;</span>, 1);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// retrieve the original entity instance</span></div>
<div class="line">$persistenceFacade = ObjectFactory::getInstance(<span class="stringliteral">&#39;persistenceFacade&#39;</span>);</div>
<div class="line">$book = $persistenceFacade-&gt;load($oid);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// localize the instance</span></div>
<div class="line">$book-&gt;setValue(<span class="stringliteral">&#39;title&#39;</span>, <span class="stringliteral">&#39;Übersetzter Titel&#39;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// save the translation</span></div>
<div class="line">$localization = ObjectFactory::getInstance(<span class="stringliteral">&#39;localization&#39;</span>);</div>
<div class="line">$localization-&gt;saveTranslation($book, <span class="stringliteral">&#39;de&#39;</span>);</div>
</div><!-- fragment --></div><div class="php"></div><p>The localization <b>configuration</b> of the <a class="el" href="gettingstarted.html#app">default application</a> is the following:</p>
<div class="ini"> <div class="fragment"><div class="line">[Localization]</div>
<div class="line">__class = wcmf\lib\i18n\impl\DefaultLocalization</div>
<div class="line">defaultLanguage = en</div>
<div class="line">languageType = app.src.model.wcmf.Language</div>
<div class="line">translationType = app.src.model.wcmf.Translation</div>
<div class="line"> </div>
<div class="line">[Languages]</div>
<div class="line">de = Deutsch</div>
<div class="line">en = English</div>
</div><!-- fragment --></div><div class="ini"></div><p>In this example the <em>default model language</em> is set to English and the <em>language entity type</em> is ignored, because the available languages are defined in the configuration. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<div class="ttc" id="anamespacewcmf_html"><div class="ttname"><a href="namespacewcmf.html">wcmf</a></div></div>
<!-- start footer part -->
      </div>
    </div>
  </div>
</div>
<hr>
<footer>
  <div class="container">
    <div class="row">
      <div class="col-md-9">
        <small>&copy; 2020 <a href="http://www.wemove.com" target="_blank">wemove digital solutions</a><br>
          Generated on Mon Dec 21 2020 22:40:28 for wCMF by &#160;<a href="http://www.doxygen.org/index.html" target="_blank">doxygen</a> 1.8.17</small>
      </div>
    </div>
  </div>
</footer>
<!-- Matomo -->
<script type="text/javascript">
  var _paq = _paq || [];
  /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="https://piwik.wemove.com/";
    _paq.push(['setTrackerUrl', u+'piwik.php']);
    _paq.push(['setSiteId', '7']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<noscript><img src="https://piwik.wemove.com/piwik.php?idsite=7&rec=1" style="border:0" alt="" /></noscript>
<!-- End Matomo -->
</body>
</html>
