<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>wCMF 4.0: application/controller/CopyController.php Source File</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="A MDSD framework for building reliable, maintainable and extendable web applications with PHP">
  <meta name="keywords" content="PHP, web application framework, model driven development">
  <meta name="author" content="wemove digital solutions">
  <link rel="shortcut icon" href="theme/images/favicon.ico">
  <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
  <!--[if lt IE 9]>
        <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
      <![endif]-->
  <link href="theme/css/doxstyles.css" rel="stylesheet">
  <script src="jquery.js"></script>
  <script src="theme/bootstrap3/js/bootstrap.min.js"></script>
  <link href="theme/bootstrap3/css/bootstrap.min.css" rel="stylesheet">
  <link href="theme/bootstrap3/css/font-awesome.min.css" rel="stylesheet">
  <script src="theme/js/tocify/jquery.tocify.min.js"></script>
  <link href="theme/js/tocify/jquery.tocify.css" rel="stylesheet">
  <script src="theme/js/doxy-boot.js"></script>
  <script src="theme/js/application.js"></script>
  <script src="dynsections.js"></script>
  <link href="theme/css/syntax.css" rel="stylesheet">
  <link href="theme/css/style.css" rel="stylesheet">
  <script src="search/search.js"></script>
  <script src="search/searchdata.js"></script>
</head>
<body style="min-height: 200px; padding-top: 50px;">
<header class="navbar navbar-inverse navbar-fixed-top bs-docs-nav">
  <div class="container">
    <div class="row">
      <div class="col-md-offset-1 col-sm-offset-0 col-md-10">
        <div class="navbar-header">
          <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".menu-navbar-collapse">
            <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="index.html">wCMF 4.0</a>
        </div>
        <div class="collapse navbar-collapse menu-navbar-collapse" role="navigation">
          <ul class="nav navbar-nav">
            <li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="fa fa-hand-o-right"></i> Guides <b class="caret"></b></a>
              <ul class="dropdown-menu">
                <li><a href="gettingstarted.html">Getting started</a></li>
                <li><a href="architecture.html">Architecture</a></li>
                <li><a href="model.html">Model</a></li>
                <li><a href="persistence.html">Persistence</a></li>
                <li><a href="presentation.html">Presentation</a></li>
                <li><a href="configuration.html">Configuration</a></li>
                <li><a href="security.html">Security</a></li>
                <li><a href="i18n_l10n.html">I18n & l10n</a></li>
                <li><a href="tests.html">Tests</a></li>
              </ul>
            </li>
            <li class="dropdown"><a href="annotated.html"><i class="fa fa-file-text-o"></i> API</a></li>
            <li><a href="https://github.com/iherwig/wcmf"><i class="fa fa-github"></i> Code</a></li>
            <li><a href="support.html"><i class="fa fa-support"></i> Support</a></li>
          </ul>
          <ul class="nav navbar-nav pull-right">
            <li>
              <div id="MSearchBox">
                <input id="MSearchField" type="text" class="form-control" placeholder="Search API" name="query" onkeyup="searchBox.OnSearchFieldChange(event)">
              </div>
              <div id="MSearchSelect"></div>
              <div id="MSearchClose"></div>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</header>
<a class="anchor" id="top"></a>
<div class="content" id="content">
  <div class="container">
    <div class="row" style="margin-top: 20px;">
      <div class="col-md-offset-1 col-sm-offset-0 col-md-10 panel panel-default">
       <div>
<!-- end header part --><!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
//var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_2f37eedf7d35aaf3dbd03bc72596cb1d.html">wcmf_older</a></li><li class="navelem"><a class="el" href="dir_f8c980795719a21d127c2aa54d5f48a2.html">wcmf</a></li><li class="navelem"><a class="el" href="dir_887d14fad5e0ff768536a703b20a65b6.html">src</a></li><li class="navelem"><a class="el" href="dir_8d315ded3d8809bdca406340d4217ac5.html">wcmf</a></li><li class="navelem"><a class="el" href="dir_92ecf41c7c746b69a18e17c24e2a7177.html">application</a></li><li class="navelem"><a class="el" href="dir_be4702f5867fb6cb6c12c079a53e2a9d.html">controller</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">CopyController.php</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;?php<span class="comment"></span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> * wCMF - wemove Content Management Framework</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> * Copyright (C) 2005-2015 wemove digital solutions GmbH</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> * Licensed under the terms of the MIT License.</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> * See the LICENSE file distributed with this work for</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> * additional information.</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespacewcmf_1_1application_1_1controller.html">wcmf\application\controller</a>;</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;use <a class="code" href="namespacewcmf_1_1application_1_1controller_1_1_batch_controller.html">wcmf\application\controller\BatchController</a>;</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;use <a class="code" href="namespacewcmf_1_1lib_1_1model_1_1_node_util.html">wcmf\lib\model\NodeUtil</a>;</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;use <a class="code" href="namespacewcmf_1_1lib_1_1model_1_1_persistent_iterator.html">wcmf\lib\model\PersistentIterator</a>;</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;use <a class="code" href="namespacewcmf_1_1lib_1_1persistence_1_1_object_id.html">wcmf\lib\persistence\ObjectId</a>;</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;use <a class="code" href="namespacewcmf_1_1lib_1_1persistence_1_1_persistence_exception.html">wcmf\lib\persistence\PersistenceException</a>;</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;use <a class="code" href="namespacewcmf_1_1lib_1_1persistence_1_1_persistent_object.html">wcmf\lib\persistence\PersistentObject</a>;</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;use <a class="code" href="namespacewcmf_1_1lib_1_1presentation_1_1_application_error.html">wcmf\lib\presentation\ApplicationError</a>;</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;use <a class="code" href="namespacewcmf_1_1lib_1_1presentation_1_1_request.html">wcmf\lib\presentation\Request</a>;</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;use <a class="code" href="namespacewcmf_1_1lib_1_1presentation_1_1_response.html">wcmf\lib\presentation\Response</a>;</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment"> * CopyController is used to copy or move Node instances.</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment"> * The controller supports the following actions:</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment"> * &lt;div class=&quot;controller-action&quot;&gt;</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment"> * &lt;div&gt; __Action__ move &lt;/div&gt;</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment"> * &lt;div&gt;</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment"> * Move the given Node and its children to the given target Node (delete original Node).</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment"> * | Parameter             | Description</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment"> * |-----------------------|-------------------------</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment"> * | _in_ `oid`            | The object id of the Node to move. The Node and all of its children will be moved</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment"> * | _in_ `targetOid`      | The object id of the parent to attach the moved Node to (if it does not accept the Node type an error occurs) (optional, if empty the new Node has no parent)</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment"> * | _out_ `oid`           | The object id of the newly created Node</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment"> * &lt;/div&gt;</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment"> * &lt;/div&gt;</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="comment"> * &lt;div class=&quot;controller-action&quot;&gt;</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment"> * &lt;div&gt; __Action__ copy &lt;/div&gt;</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="comment"> * &lt;div&gt;</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="comment"> * Copy the given Node and its children to the given target Node (keep original Node).</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="comment"> * | Parameter             | Description</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment"> * |-----------------------|-------------------------</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="comment"> * | _in_ `oid`            | The object id of the Node to move. The Node and all of its children will be moved</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="comment"> * | _in_ `targetOid`      | The object id of the parent to attach the moved Node to (if it does not accept the Node type an error occurs) (optional, if empty the new Node has no parent)</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment"> * | _in_ `nodesPerCall`   | The number of Node instances to copy in one call (default: 50)</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="comment"> * | _in_ `recursive`      | Boolean whether to copy children too (default: _true_)</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="comment"> * &lt;/div&gt;</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="comment"> * &lt;/div&gt;</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="comment"> * For additional actions and parameters see [BatchController actions](@ref BatchController).</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="comment"> * @author ingo herwig &lt;ingo@wemove.com&gt;</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00057"></a><span class="lineno"><a class="line" href="classwcmf_1_1application_1_1controller_1_1_copy_controller.html">   57</a></span>&#160;<span class="keyword">class </span><a class="code" href="classwcmf_1_1application_1_1controller_1_1_copy_controller.html">CopyController</a> <span class="keyword">extends</span> <a class="code" href="classwcmf_1_1application_1_1controller_1_1_batch_controller.html">BatchController</a> {</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  <span class="comment">// session name constants</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  <span class="keyword">private</span> $REQUEST = <span class="stringliteral">&#39;CopyController.request&#39;</span>;</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;  <span class="keyword">private</span> $OBJECT_MAP = <span class="stringliteral">&#39;CopyController.objectmap&#39;</span>;</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;  <span class="keyword">private</span> $ITERATOR_ID = <span class="stringliteral">&#39;CopyController.iteratorid&#39;</span>;</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  <span class="keyword">private</span> $_targetNode = null;</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;  <span class="comment">// default values, maybe overriden by corresponding request values (see above)</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  <span class="keyword">private</span> $_NODES_PER_CALL = 50;</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="comment">  /**</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="comment">   * @see Controller::initialize()</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="comment">   */</span></div>
<div class="line"><a name="l00072"></a><span class="lineno"><a class="line" href="classwcmf_1_1application_1_1controller_1_1_copy_controller.html#a47a24ac0d700f62a9434d298ade72fb9">   72</a></span>&#160;  <span class="keyword">public</span> <span class="keyword">function</span> <a class="code" href="classwcmf_1_1application_1_1controller_1_1_copy_controller.html#a47a24ac0d700f62a9434d298ade72fb9">initialize</a>(<a class="code" href="interfacewcmf_1_1lib_1_1presentation_1_1_request.html">Request</a> $request, <a class="code" href="interfacewcmf_1_1lib_1_1presentation_1_1_response.html">Response</a> $response) {</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    parent::initialize($request, $response);</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    <span class="comment">// initialize controller</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    <span class="keywordflow">if</span> ($request-&gt;<a class="code" href="interfacewcmf_1_1lib_1_1presentation_1_1_controller_message.html#a189a4abe5faf11f4320d5d3f1d3d1715">getAction</a>() != <span class="stringliteral">&#39;continue&#39;</span>) {</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;      $session = $this-&gt;<a class="code" href="classwcmf_1_1lib_1_1presentation_1_1_controller.html#aefa4c5bd150e2a7d525576d7959c6911">getSession</a>();</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;      <span class="comment">// set defaults</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;      <span class="keywordflow">if</span> (!$request-&gt;<a class="code" href="interfacewcmf_1_1lib_1_1presentation_1_1_controller_message.html#a270bd65d789405427f5005ef5b0e0f38">hasValue</a>(<span class="stringliteral">&#39;nodesPerCall&#39;</span>)) {</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;        $request-&gt;<a class="code" href="interfacewcmf_1_1lib_1_1presentation_1_1_controller_message.html#a8e7aaacf604710d7f853f3261d84b9fc">setValue</a>(<span class="stringliteral">&#39;nodesPerCall&#39;</span>, $this-&gt;_NODES_PER_CALL);</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;      }</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;      <span class="keywordflow">if</span> (!$request-&gt;<a class="code" href="interfacewcmf_1_1lib_1_1presentation_1_1_controller_message.html#a270bd65d789405427f5005ef5b0e0f38">hasValue</a>(<span class="stringliteral">&#39;recursive&#39;</span>)) {</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;        $request-&gt;<a class="code" href="interfacewcmf_1_1lib_1_1presentation_1_1_controller_message.html#a8e7aaacf604710d7f853f3261d84b9fc">setValue</a>(<span class="stringliteral">&#39;recursive&#39;</span>, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;      }</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;      <span class="comment">// store request in session</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;      $session-&gt;set($this-&gt;REQUEST, $request);</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;      $map = array();</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;      $session-&gt;set($this-&gt;OBJECT_MAP, $map);</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    }</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  }</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="comment">  /**</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="comment">   * @see Controller::validate()</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="comment">   */</span></div>
<div class="line"><a name="l00097"></a><span class="lineno"><a class="line" href="classwcmf_1_1application_1_1controller_1_1_copy_controller.html#a184909dab34698899937d810a9f5d393">   97</a></span>&#160;  <span class="keyword">protected</span> <span class="keyword">function</span> <a class="code" href="classwcmf_1_1application_1_1controller_1_1_copy_controller.html#a184909dab34698899937d810a9f5d393">validate</a>() {</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    $request = $this-&gt;<a class="code" href="classwcmf_1_1lib_1_1presentation_1_1_controller.html#adf1a35ad20e475c59cc0967d5764aa22">getRequest</a>();</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    $response = $this-&gt;<a class="code" href="classwcmf_1_1lib_1_1presentation_1_1_controller.html#a6c907e8af775e517a77037dd0164222f">getResponse</a>();</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    <span class="keywordflow">if</span> ($request-&gt;getAction() != <span class="stringliteral">&#39;continue&#39;</span>) {</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;      <span class="comment">// check request values</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;      $oid = <a class="code" href="classwcmf_1_1lib_1_1persistence_1_1_object_id.html#a2441c8f369adef96455b48af3467b42f">ObjectId::parse</a>($request-&gt;getValue(<span class="stringliteral">&#39;oid&#39;</span>));</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;      <span class="keywordflow">if</span>(!$oid) {</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;        $response-&gt;addError(<a class="code" href="classwcmf_1_1lib_1_1presentation_1_1_application_error.html#a7b6de2953b070910660cee9f229bc554">ApplicationError::get</a>(<span class="stringliteral">&#39;OID_INVALID&#39;</span>,</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;          array(<span class="stringliteral">&#39;invalidOids&#39;</span> =&gt; array($request-&gt;getValue(<span class="stringliteral">&#39;oid&#39;</span>)))));</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;      }</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;      <span class="keywordflow">if</span>($request-&gt;hasValue(<span class="stringliteral">&#39;targetoid&#39;</span>)) {</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;        $targetoid = <a class="code" href="classwcmf_1_1lib_1_1persistence_1_1_object_id.html#a2441c8f369adef96455b48af3467b42f">ObjectId::parse</a>($request-&gt;getValue(<span class="stringliteral">&#39;targetoid&#39;</span>));</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;        <span class="keywordflow">if</span>(!$targetoid) {</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;          $response-&gt;addError(<a class="code" href="classwcmf_1_1lib_1_1presentation_1_1_application_error.html#a7b6de2953b070910660cee9f229bc554">ApplicationError::get</a>(<span class="stringliteral">&#39;OID_INVALID&#39;</span>,</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;            array(<span class="stringliteral">&#39;invalidOids&#39;</span> =&gt; array($request-&gt;getValue(<span class="stringliteral">&#39;targetoid&#39;</span>)))));</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;          <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;        }</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;      }</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;      <span class="comment">// check if the parent accepts this node type (only when not adding to root)</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;      $addOk = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;      <span class="keywordflow">if</span> ($request-&gt;hasValue(<span class="stringliteral">&#39;targetoid&#39;</span>)) {</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;        $persistenceFacade = $this-&gt;<a class="code" href="classwcmf_1_1lib_1_1presentation_1_1_controller.html#ad01d1e66179edfeb910b32001222361d">getPersistenceFacade</a>();</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        $targetOID = <a class="code" href="classwcmf_1_1lib_1_1persistence_1_1_object_id.html#a2441c8f369adef96455b48af3467b42f">ObjectId::parse</a>($request-&gt;getValue(<span class="stringliteral">&#39;targetoid&#39;</span>));</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;        $nodeOID = <a class="code" href="classwcmf_1_1lib_1_1persistence_1_1_object_id.html#a2441c8f369adef96455b48af3467b42f">ObjectId::parse</a>($request-&gt;getValue(<span class="stringliteral">&#39;oid&#39;</span>));</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;        $targetNode = $this-&gt;<a class="code" href="classwcmf_1_1application_1_1controller_1_1_copy_controller.html#a223349db2074bd54262570eaff288364">getTargetNode</a>($targetOID);</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;        $nodeType = $nodeOID-&gt;getType();</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;        $targetType = $targetOID-&gt;getType();</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;        $tplNode = $persistenceFacade-&gt;create($targetType, 1);</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;        $possibleChildren = NodeUtil::getPossibleChildren($targetNode, $tplNode);</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;        <span class="keywordflow">if</span> (!in_array($nodeType, array_keys($possibleChildren))) {</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;          $response-&gt;addError(<a class="code" href="classwcmf_1_1lib_1_1presentation_1_1_application_error.html#a7b6de2953b070910660cee9f229bc554">ApplicationError::get</a>(<span class="stringliteral">&#39;ASSOCIATION_INVALID&#39;</span>));</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;          $addOk = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;        }</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;        <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;          $template = $possibleChildren[$nodeType];</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;          <span class="keywordflow">if</span> (!$template-&gt;getProperty(<span class="stringliteral">&#39;canCreate&#39;</span>)) {</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;            $response-&gt;addError(<a class="code" href="classwcmf_1_1lib_1_1presentation_1_1_application_error.html#a7b6de2953b070910660cee9f229bc554">ApplicationError::get</a>(<span class="stringliteral">&#39;ASSOCIATION_INVALID&#39;</span>));</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;            $addOk = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;          }</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;        }</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;      }</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;      <span class="keywordflow">if</span> (!$addOk) {</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;      }</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    }</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <span class="comment">// do default validation</span></div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    <span class="keywordflow">return</span> parent::validate();</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;  }</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="comment">  /**</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="comment">   * @see BatchController::getWorkPackage()</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="comment">   */</span></div>
<div class="line"><a name="l00153"></a><span class="lineno"><a class="line" href="classwcmf_1_1application_1_1controller_1_1_copy_controller.html#aa969f966d1ab74704cbde9512d281d2c">  153</a></span>&#160;  <span class="keyword">protected</span> <span class="keyword">function</span> <a class="code" href="classwcmf_1_1application_1_1controller_1_1_copy_controller.html#aa969f966d1ab74704cbde9512d281d2c">getWorkPackage</a>($number) {</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    $request = $this-&gt;<a class="code" href="classwcmf_1_1lib_1_1presentation_1_1_controller.html#adf1a35ad20e475c59cc0967d5764aa22">getRequest</a>();</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    $message = $this-&gt;<a class="code" href="classwcmf_1_1lib_1_1presentation_1_1_controller.html#a0b0e611236742aac18ba1936d03ba89a">getMessage</a>();</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    $name = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    <span class="keywordflow">if</span> ($request-&gt;getAction() == <span class="stringliteral">&#39;move&#39;</span>) {</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;      $name = $message-&gt;getText(<span class="stringliteral">&#39;Moving&#39;</span>);</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    }</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ($request-&gt;getAction() == <span class="stringliteral">&#39;copy&#39;</span>) {</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;      $name = $message-&gt;getText(<span class="stringliteral">&#39;Copying&#39;</span>);</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    }</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    $name .= <span class="stringliteral">&#39;: &#39;</span>.$request-&gt;getValue(<span class="stringliteral">&#39;oid&#39;</span>);</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <span class="keywordflow">if</span> ($number == 0) {</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;      <span class="keywordflow">return</span> array(<span class="stringliteral">&#39;name&#39;</span> =&gt; $name, <span class="stringliteral">&#39;size&#39;</span> =&gt; 1, <span class="stringliteral">&#39;oids&#39;</span> =&gt; array(1), <span class="stringliteral">&#39;callback&#39;</span> =&gt; <span class="stringliteral">&#39;startProcess&#39;</span>);</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    }</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;      <span class="keywordflow">return</span> null;</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    }</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;  }</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;<span class="comment">  /**</span></div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;<span class="comment">   * Copy/Move the first node (oids parameter will be ignored)</span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="comment">   * @param $oids The oids to process</span></div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="comment">   */</span></div>
<div class="line"><a name="l00177"></a><span class="lineno"><a class="line" href="classwcmf_1_1application_1_1controller_1_1_copy_controller.html#a3b581a2091b700061c9426fde625b3eb">  177</a></span>&#160;  <span class="keyword">protected</span> <span class="keyword">function</span> <a class="code" href="classwcmf_1_1application_1_1controller_1_1_copy_controller.html#a3b581a2091b700061c9426fde625b3eb">startProcess</a>($oids) {</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    $session = $this-&gt;<a class="code" href="classwcmf_1_1lib_1_1presentation_1_1_controller.html#aefa4c5bd150e2a7d525576d7959c6911">getSession</a>();</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    $persistenceFacade = $this-&gt;<a class="code" href="classwcmf_1_1lib_1_1presentation_1_1_controller.html#ad01d1e66179edfeb910b32001222361d">getPersistenceFacade</a>();</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    <span class="comment">// restore the request from session</span></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    $request = $session-&gt;get($this-&gt;REQUEST);</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    $action = $request-&gt;getAction();</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    $targetOID = <a class="code" href="classwcmf_1_1lib_1_1persistence_1_1_object_id.html#a2441c8f369adef96455b48af3467b42f">ObjectId::parse</a>($request-&gt;getValue(<span class="stringliteral">&#39;targetoid&#39;</span>));</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    $nodeOID = <a class="code" href="classwcmf_1_1lib_1_1persistence_1_1_object_id.html#a2441c8f369adef96455b48af3467b42f">ObjectId::parse</a>($request-&gt;getValue(<span class="stringliteral">&#39;oid&#39;</span>));</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    <span class="comment">// do the action</span></div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    <span class="keywordflow">if</span> ($action == <span class="stringliteral">&#39;move&#39;</span>) {</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;      $persistenceFacade = $this-&gt;<a class="code" href="classwcmf_1_1lib_1_1presentation_1_1_controller.html#ad01d1e66179edfeb910b32001222361d">getPersistenceFacade</a>();</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;      $transaction = $persistenceFacade-&gt;getTransaction();</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;      $transaction-&gt;begin();</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;      <span class="comment">// with move action, we only need to attach the Node to the new target</span></div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;      <span class="comment">// the children will not be loaded, they will be moved automatically</span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;      $nodeCopy = $persistenceFacade-&gt;load($nodeOID);</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;      <span class="keywordflow">if</span> ($nodeCopy) {</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;        <span class="keywordflow">if</span> ($targetOID != null) {</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;          <span class="comment">// attach the node to the target node</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;          $parentNode = $this-&gt;<a class="code" href="classwcmf_1_1application_1_1controller_1_1_copy_controller.html#a223349db2074bd54262570eaff288364">getTargetNode</a>($targetOID);</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;          $parentNode-&gt;addNode($nodeCopy);</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;        }</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;        $this-&gt;<a class="code" href="classwcmf_1_1application_1_1controller_1_1_copy_controller.html#aed1f22bd7cbc1e41053fb78f4fcb345f">modify</a>($nodeCopy);</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        <span class="comment">// set the result and finish</span></div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;        $this-&gt;<a class="code" href="classwcmf_1_1application_1_1controller_1_1_copy_controller.html#acdeb10247722f1d8439e86db3f63f3e5">endProcess</a>($nodeCopy-&gt;getOID());</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;        $logger = $this-&gt;<a class="code" href="classwcmf_1_1lib_1_1presentation_1_1_controller.html#a2321df4f2f7d188b92b96fe63dc71a90">getLogger</a>();</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;        <span class="keywordflow">if</span> ($logger-&gt;isInfoEnabled()) {</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;          $logger-&gt;info(<span class="stringliteral">&quot;Moved: &quot;</span>.$nodeOID.<span class="stringliteral">&quot; to &quot;</span>.$parentNode-&gt;getOID());</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;        }</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;      }</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;      $transaction-&gt;commit();</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    }</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ($action == <span class="stringliteral">&#39;copy&#39;</span>) {</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;      <span class="comment">// with copy action, we need to attach a copy of the Node to the new target,</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;      <span class="comment">// the children need to be loaded and treated in the same way too</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;      $iterator = <span class="keyword">new</span> <a class="code" href="classwcmf_1_1lib_1_1model_1_1_persistent_iterator.html">PersistentIterator</a>($persistenceFacade, $session, $nodeOID,</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;              array(<span class="stringliteral">&#39;composite&#39;</span>));</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;      $iteratorID = $iterator-&gt;save();</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;      $session-&gt;set($this-&gt;ITERATOR_ID, $iteratorID);</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;      <span class="comment">// copy the first node in order to reduce the number of calls for a single copy</span></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;      $nodeCopy = $this-&gt;<a class="code" href="classwcmf_1_1application_1_1controller_1_1_copy_controller.html#a6a579224d13256212b3e8fc47bb44814">copyNode</a>($iterator-&gt;current());</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;      <span class="keywordflow">if</span> ($nodeCopy) {</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;        <span class="keywordflow">if</span> ($targetOID != null) {</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;          <span class="comment">// attach the copy to the target node</span></div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;          $parentNode = $this-&gt;<a class="code" href="classwcmf_1_1application_1_1controller_1_1_copy_controller.html#a223349db2074bd54262570eaff288364">getTargetNode</a>($targetOID);</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;          $parentNode-&gt;addNode($nodeCopy);</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;        }</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;        $this-&gt;<a class="code" href="classwcmf_1_1application_1_1controller_1_1_copy_controller.html#aed1f22bd7cbc1e41053fb78f4fcb345f">modify</a>($nodeCopy);</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;        $iterator-&gt;next();</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;        <span class="comment">// proceed if nodes are left</span></div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;        <span class="keywordflow">if</span> ($request-&gt;getBooleanValue(<span class="stringliteral">&#39;recursive&#39;</span>) &amp;&amp; $iterator-&gt;valid()) {</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;          $iteratorID = $iterator-&gt;save();</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;          $session-&gt;set($this-&gt;ITERATOR_ID, $iteratorID);</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;          $name = $this-&gt;<a class="code" href="classwcmf_1_1lib_1_1presentation_1_1_controller.html#a0b0e611236742aac18ba1936d03ba89a">getMessage</a>()-&gt;getText(<span class="stringliteral">&#39;Copying tree: continue with %0%&#39;</span>,</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;                  array($iterator-&gt;current()));</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;          $this-&gt;<a class="code" href="classwcmf_1_1application_1_1controller_1_1_batch_controller.html#ab0e75dc0967afe71da4d6bd46d7a500b">addWorkPackage</a>($name, 1, array(null), <span class="stringliteral">&#39;copyNodes&#39;</span>);</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;        }</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;        <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;          <span class="comment">// set the result and finish</span></div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;          $this-&gt;<a class="code" href="classwcmf_1_1application_1_1controller_1_1_copy_controller.html#acdeb10247722f1d8439e86db3f63f3e5">endProcess</a>($nodeCopy-&gt;getOID());</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;        }</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;      }</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    }</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;  }</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;<span class="comment">  /**</span></div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;<span class="comment">   * Copy nodes provided by the persisted iterator (oids parameter will be ignored)</span></div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;<span class="comment">   * @param $oids The oids to process</span></div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;<span class="comment">   */</span></div>
<div class="line"><a name="l00256"></a><span class="lineno"><a class="line" href="classwcmf_1_1application_1_1controller_1_1_copy_controller.html#a2255ef44e4296fb56725bc04220f2a96">  256</a></span>&#160;  <span class="keyword">protected</span> <span class="keyword">function</span> <a class="code" href="classwcmf_1_1application_1_1controller_1_1_copy_controller.html#a2255ef44e4296fb56725bc04220f2a96">copyNodes</a>($oids) {</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    $session = $this-&gt;<a class="code" href="classwcmf_1_1lib_1_1presentation_1_1_controller.html#aefa4c5bd150e2a7d525576d7959c6911">getSession</a>();</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    $persistenceFacade = $this-&gt;<a class="code" href="classwcmf_1_1lib_1_1presentation_1_1_controller.html#ad01d1e66179edfeb910b32001222361d">getPersistenceFacade</a>();</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    <span class="comment">// restore the request from session</span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    $request = $session-&gt;get($this-&gt;REQUEST);</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    $action = $request-&gt;getAction();</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    $targetOID = <a class="code" href="classwcmf_1_1lib_1_1persistence_1_1_object_id.html#a2441c8f369adef96455b48af3467b42f">ObjectId::parse</a>($request-&gt;getValue(<span class="stringliteral">&#39;targetoid&#39;</span>));</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    $nodeOID = <a class="code" href="classwcmf_1_1lib_1_1persistence_1_1_object_id.html#a2441c8f369adef96455b48af3467b42f">ObjectId::parse</a>($request-&gt;getValue(<span class="stringliteral">&#39;oid&#39;</span>));</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    <span class="comment">// check for iterator in session</span></div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    $iterator = null;</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    $iteratorID = $session-&gt;get($this-&gt;ITERATOR_ID);</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    <span class="keywordflow">if</span> ($iteratorID != null) {</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;      $iterator = <a class="code" href="classwcmf_1_1lib_1_1model_1_1_persistent_iterator.html#a9f718c0c21b0451481dcc093e7fdadf8">PersistentIterator::load</a>($persistenceFacade, $session, $iteratorID);</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    }</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    <span class="comment">// no iterator, finish</span></div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    <span class="keywordflow">if</span> ($iterator == null) {</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;      <span class="comment">// set the result and finish</span></div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;      $this-&gt;<a class="code" href="classwcmf_1_1application_1_1controller_1_1_copy_controller.html#acdeb10247722f1d8439e86db3f63f3e5">endProcess</a>($this-&gt;<a class="code" href="classwcmf_1_1application_1_1controller_1_1_copy_controller.html#a6b705c655ffb88c756bc0d8078c07975">getCopyOID</a>($nodeOID));</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    }</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    <span class="comment">// process _NODES_PER_CALL nodes</span></div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    $counter = 0;</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    <span class="keywordflow">while</span> ($iterator-&gt;valid() &amp;&amp; $counter &lt; $request-&gt;getValue(<span class="stringliteral">&#39;nodesPerCall&#39;</span>)) {</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;      $currentOID = $iterator-&gt;current();</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;      $this-&gt;<a class="code" href="classwcmf_1_1application_1_1controller_1_1_copy_controller.html#a6a579224d13256212b3e8fc47bb44814">copyNode</a>($currentOID);</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;      $iterator-&gt;next();</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;      $counter++;</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    }</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    <span class="comment">// decide what to do next</span></div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    <span class="keywordflow">if</span> ($iterator-&gt;valid()) {</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;      <span class="comment">// proceed with current iterator</span></div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;      $iteratorID = $iterator-&gt;save();</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;      $session-&gt;set($this-&gt;ITERATOR_ID, $iteratorID);</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;      $name = $this-&gt;<a class="code" href="classwcmf_1_1lib_1_1presentation_1_1_controller.html#a0b0e611236742aac18ba1936d03ba89a">getMessage</a>()-&gt;getText(<span class="stringliteral">&#39;Copying tree: continue with %0%&#39;</span>,</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;              array($iterator-&gt;current()));</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;      $this-&gt;<a class="code" href="classwcmf_1_1application_1_1controller_1_1_batch_controller.html#ab0e75dc0967afe71da4d6bd46d7a500b">addWorkPackage</a>($name, 1, array(null), <span class="stringliteral">&#39;copyNodes&#39;</span>);</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    }</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;      <span class="comment">// set the result and finish</span></div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;      $this-&gt;<a class="code" href="classwcmf_1_1application_1_1controller_1_1_copy_controller.html#acdeb10247722f1d8439e86db3f63f3e5">endProcess</a>($this-&gt;<a class="code" href="classwcmf_1_1application_1_1controller_1_1_copy_controller.html#a6b705c655ffb88c756bc0d8078c07975">getCopyOID</a>($nodeOID));</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    }</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;  }</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;<span class="comment">  /**</span></div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="comment">   * Finish the process and set the result</span></div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;<span class="comment">   * @param $oid The object id of the newly created Node</span></div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;<span class="comment">   */</span></div>
<div class="line"><a name="l00309"></a><span class="lineno"><a class="line" href="classwcmf_1_1application_1_1controller_1_1_copy_controller.html#acdeb10247722f1d8439e86db3f63f3e5">  309</a></span>&#160;  <span class="keyword">protected</span> <span class="keyword">function</span> <a class="code" href="classwcmf_1_1application_1_1controller_1_1_copy_controller.html#acdeb10247722f1d8439e86db3f63f3e5">endProcess</a>(<a class="code" href="classwcmf_1_1lib_1_1persistence_1_1_object_id.html">ObjectId</a> $oid) {</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    $response = $this-&gt;<a class="code" href="classwcmf_1_1lib_1_1presentation_1_1_controller.html#a6c907e8af775e517a77037dd0164222f">getResponse</a>();</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    $response-&gt;setValue(<span class="stringliteral">&#39;oid&#39;</span>, $oid);</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    $session = $this-&gt;<a class="code" href="classwcmf_1_1lib_1_1presentation_1_1_controller.html#aefa4c5bd150e2a7d525576d7959c6911">getSession</a>();</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    <span class="comment">// clear session variables</span></div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    $tmp = null;</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    $session-&gt;set($this-&gt;REQUEST, $tmp);</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    $session-&gt;set($this-&gt;OBJECT_MAP, $tmp);</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    $session-&gt;set($this-&gt;ITERATOR_ID, $tmp);</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;  }</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;<span class="comment">  /**</span></div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;<span class="comment">   * Create a copy of the node with the given object id. The returned</span></div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;<span class="comment">   * node is already persisted.</span></div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;<span class="comment">   * @param $oid The oid of the node to copy</span></div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;<span class="comment">   * @return The copied Node or null</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;<span class="comment">   */</span></div>
<div class="line"><a name="l00328"></a><span class="lineno"><a class="line" href="classwcmf_1_1application_1_1controller_1_1_copy_controller.html#a6a579224d13256212b3e8fc47bb44814">  328</a></span>&#160;  <span class="keyword">protected</span> <span class="keyword">function</span> <a class="code" href="classwcmf_1_1application_1_1controller_1_1_copy_controller.html#a6a579224d13256212b3e8fc47bb44814">copyNode</a>(<a class="code" href="classwcmf_1_1lib_1_1persistence_1_1_object_id.html">ObjectId</a> $oid) {</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    $logger = $this-&gt;<a class="code" href="classwcmf_1_1lib_1_1presentation_1_1_controller.html#a2321df4f2f7d188b92b96fe63dc71a90">getLogger</a>();</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    <span class="keywordflow">if</span> ($logger-&gt;isDebugEnabled()) {</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;      $logger-&gt;debug(<span class="stringliteral">&quot;Copying node &quot;</span>.$oid);</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    }</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    $persistenceFacade = $this-&gt;<a class="code" href="classwcmf_1_1lib_1_1presentation_1_1_controller.html#ad01d1e66179edfeb910b32001222361d">getPersistenceFacade</a>();</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    $transaction = $persistenceFacade-&gt;getTransaction();</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    $transaction-&gt;begin();</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    <span class="comment">// load the original node</span></div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    $node = $persistenceFacade-&gt;load($oid);</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    <span class="keywordflow">if</span> ($node == null) {</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;      <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classwcmf_1_1lib_1_1persistence_1_1_persistence_exception.html">PersistenceException</a>(<span class="stringliteral">&quot;Can&#39;t load node &#39;&quot;</span>.$oid.<span class="stringliteral">&quot;&#39;&quot;</span>);</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    }</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    <span class="comment">// check if we already have a copy of the node</span></div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    $nodeCopy = $this-&gt;<a class="code" href="classwcmf_1_1application_1_1controller_1_1_copy_controller.html#a61d7958d10a50fcd3966305bc98a41b2">getCopy</a>($node-&gt;getOID());</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    <span class="keywordflow">if</span> ($nodeCopy == null) {</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;      <span class="comment">// if not, create it</span></div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;      $nodeCopy = $persistenceFacade-&gt;create($node-&gt;getType());</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;      $node-&gt;copyValues($nodeCopy, <span class="keyword">false</span>);</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    }</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    <span class="comment">// save copy</span></div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    $this-&gt;<a class="code" href="classwcmf_1_1application_1_1controller_1_1_copy_controller.html#a823495e057cd13b2aa84fc913a832f26">registerCopy</a>($node, $nodeCopy);</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    <span class="keywordflow">if</span> ($logger-&gt;isInfoEnabled()) {</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;      $logger-&gt;info(<span class="stringliteral">&quot;Copied: &quot;</span>.$node-&gt;getOID().<span class="stringliteral">&quot; to &quot;</span>.$nodeCopy-&gt;getOID());</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    }</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    <span class="keywordflow">if</span> ($logger-&gt;isDebugEnabled()) {</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;      $logger-&gt;debug($nodeCopy-&gt;__toString());</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    }</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    <span class="comment">// create the connections to already copied relatives</span></div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    <span class="comment">// this must be done after saving the node in order to have a correct oid</span></div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    $mapper = $node-&gt;getMapper();</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    $relations = $mapper-&gt;getRelations();</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    <span class="keywordflow">foreach</span> ($relations as $relation) {</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;      <span class="keywordflow">if</span> ($relation-&gt;getOtherNavigability()) {</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;        $otherRole = $relation-&gt;getOtherRole();</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;        $relativeValue = $node-&gt;getValue($otherRole);</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;        $relatives = $relation-&gt;isMultiValued() ? $relativeValue :</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;                ($relativeValue != null ? array($relativeValue) : array());</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;        <span class="keywordflow">foreach</span> ($relatives as $relative) {</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;          $copiedRelative = $this-&gt;<a class="code" href="classwcmf_1_1application_1_1controller_1_1_copy_controller.html#a61d7958d10a50fcd3966305bc98a41b2">getCopy</a>($relative-&gt;getOID());</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;          <span class="keywordflow">if</span> ($copiedRelative != null) {</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;            $nodeCopy-&gt;addNode($copiedRelative, $otherRole);</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;            <span class="keywordflow">if</span> ($logger-&gt;isDebugEnabled()) {</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;              $logger-&gt;debug(<span class="stringliteral">&quot;Added &quot;</span>.$copiedRelative-&gt;getOID().<span class="stringliteral">&quot; to &quot;</span>.$nodeCopy-&gt;getOID());</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;              $logger-&gt;debug($copiedRelative-&gt;__toString());</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;            }</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;          }</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;        }</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;      }</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    }</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    $changedOids = $transaction-&gt;commit();</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    $this-&gt;<a class="code" href="classwcmf_1_1application_1_1controller_1_1_copy_controller.html#a6014d16f402330aef2316a435da3c213">updateCopyOIDs</a>($changedOids);</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    <span class="keywordflow">return</span> $nodeCopy;</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;  }</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;<span class="comment">  /**</span></div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;<span class="comment">   * Get the target node from the request parameter targetoid</span></div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;<span class="comment">   * @param $targetOID The oid of the target node</span></div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;<span class="comment">   * @return Node instance</span></div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;<span class="comment">   */</span></div>
<div class="line"><a name="l00394"></a><span class="lineno"><a class="line" href="classwcmf_1_1application_1_1controller_1_1_copy_controller.html#a223349db2074bd54262570eaff288364">  394</a></span>&#160;  <span class="keyword">protected</span> <span class="keyword">function</span> <a class="code" href="classwcmf_1_1application_1_1controller_1_1_copy_controller.html#a223349db2074bd54262570eaff288364">getTargetNode</a>(<a class="code" href="classwcmf_1_1lib_1_1persistence_1_1_object_id.html">ObjectId</a> $targetOID) {</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    <span class="keywordflow">if</span> ($this-&gt;_targetNode == null) {</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;      <span class="comment">// load parent node</span></div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;      $persistenceFacade = $this-&gt;<a class="code" href="classwcmf_1_1lib_1_1presentation_1_1_controller.html#ad01d1e66179edfeb910b32001222361d">getPersistenceFacade</a>();</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;      $targetNode = $persistenceFacade-&gt;load($targetOID);</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;      $this-&gt;_targetNode = $targetNode;</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    }</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    <span class="keywordflow">return</span> $this-&gt;_targetNode;</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;  }</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;<span class="comment">  /**</span></div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;<span class="comment">   * Register a copied node in the session for later reference</span></div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;<span class="comment">   * @param $origNode A reference to the original node</span></div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;<span class="comment">   * @param $copyNode A reference to the copied node</span></div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;<span class="comment">   */</span></div>
<div class="line"><a name="l00409"></a><span class="lineno"><a class="line" href="classwcmf_1_1application_1_1controller_1_1_copy_controller.html#a823495e057cd13b2aa84fc913a832f26">  409</a></span>&#160;  <span class="keyword">protected</span> <span class="keyword">function</span> <a class="code" href="classwcmf_1_1application_1_1controller_1_1_copy_controller.html#a823495e057cd13b2aa84fc913a832f26">registerCopy</a>(<a class="code" href="interfacewcmf_1_1lib_1_1persistence_1_1_persistent_object.html">PersistentObject</a> $origNode, <a class="code" href="interfacewcmf_1_1lib_1_1persistence_1_1_persistent_object.html">PersistentObject</a> $copyNode) {</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    $session = $this-&gt;<a class="code" href="classwcmf_1_1lib_1_1presentation_1_1_controller.html#aefa4c5bd150e2a7d525576d7959c6911">getSession</a>();</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    $registry = $session-&gt;get($this-&gt;OBJECT_MAP);</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;    <span class="comment">// store oid in the registry</span></div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    $registry[$origNode-&gt;<a class="code" href="interfacewcmf_1_1lib_1_1persistence_1_1_persistent_object.html#ac886ae95a746f43906bb3b2515092440">getOID</a>()-&gt;__toString()] = $copyNode-&gt;<a class="code" href="interfacewcmf_1_1lib_1_1persistence_1_1_persistent_object.html#ac886ae95a746f43906bb3b2515092440">getOID</a>()-&gt;__toString();</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    $session-&gt;set($this-&gt;OBJECT_MAP, $registry);</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;  }</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;<span class="comment">  /**</span></div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;<span class="comment">   * Update the copied oids in the registry</span></div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;<span class="comment">   * @param $oidMap Map of changed oids (key: old value, value: new value)</span></div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;<span class="comment">   */</span></div>
<div class="line"><a name="l00421"></a><span class="lineno"><a class="line" href="classwcmf_1_1application_1_1controller_1_1_copy_controller.html#a6014d16f402330aef2316a435da3c213">  421</a></span>&#160;  <span class="keyword">protected</span> <span class="keyword">function</span> <a class="code" href="classwcmf_1_1application_1_1controller_1_1_copy_controller.html#a6014d16f402330aef2316a435da3c213">updateCopyOIDs</a>(array $oidMap) {</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    $session = $this-&gt;<a class="code" href="classwcmf_1_1lib_1_1presentation_1_1_controller.html#aefa4c5bd150e2a7d525576d7959c6911">getSession</a>();</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    $registry = $session-&gt;get($this-&gt;OBJECT_MAP);</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    <span class="comment">// registry maybe deleted already if it&#39;s the last step</span></div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    <span class="keywordflow">if</span> ($registry) {</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;      $flippedRegistry = array_flip($registry);</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;      <span class="keywordflow">foreach</span> ($oidMap as $oldOid =&gt; $newOid) {</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;        <span class="keywordflow">if</span> (isset($flippedRegistry[$oldOid])) {</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;          $key = $flippedRegistry[$oldOid];</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;          unset($flippedRegistry[$oldOid]);</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;          $flippedRegistry[$newOid] = $key;</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;        }</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;      }</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;      $registry = array_flip($flippedRegistry);</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;      $session-&gt;set($this-&gt;OBJECT_MAP, $registry);</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    }</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;  }</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;<span class="comment">  /**</span></div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;<span class="comment">   * Get the object id of the copied node for a node id</span></div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;<span class="comment">   * @param $origOID The object id of the original node</span></div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;<span class="comment">   * @return ObjectId or null, if it does not exist already</span></div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;<span class="comment">   */</span></div>
<div class="line"><a name="l00444"></a><span class="lineno"><a class="line" href="classwcmf_1_1application_1_1controller_1_1_copy_controller.html#a6b705c655ffb88c756bc0d8078c07975">  444</a></span>&#160;  <span class="keyword">protected</span> <span class="keyword">function</span> <a class="code" href="classwcmf_1_1application_1_1controller_1_1_copy_controller.html#a6b705c655ffb88c756bc0d8078c07975">getCopyOID</a>(<a class="code" href="classwcmf_1_1lib_1_1persistence_1_1_object_id.html">ObjectId</a> $origOID) {</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    $session = $this-&gt;<a class="code" href="classwcmf_1_1lib_1_1presentation_1_1_controller.html#aefa4c5bd150e2a7d525576d7959c6911">getSession</a>();</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    $registry = $session-&gt;get($this-&gt;OBJECT_MAP);</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    <span class="comment">// check if the oid exists in the registry</span></div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    $oidStr = $origOID-&gt;<a class="code" href="classwcmf_1_1lib_1_1persistence_1_1_object_id.html#a7516ca30af0db3cdbf9a7739b48ce91d">__toString</a>();</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    <span class="keywordflow">if</span> (!isset($registry[$oidStr])) {</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;      $logger = $this-&gt;<a class="code" href="classwcmf_1_1lib_1_1presentation_1_1_controller.html#a2321df4f2f7d188b92b96fe63dc71a90">getLogger</a>();</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;      <span class="keywordflow">if</span> ($logger-&gt;isDebugEnabled()) {</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;        $logger-&gt;debug(<span class="stringliteral">&quot;Copy of &quot;</span>.$oidStr.<span class="stringliteral">&quot; not found.&quot;</span>);</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;      }</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;      <span class="keywordflow">return</span> null;</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    }</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    $copyOID = <a class="code" href="classwcmf_1_1lib_1_1persistence_1_1_object_id.html#a2441c8f369adef96455b48af3467b42f">ObjectId::parse</a>($registry[$oidStr]);</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;    <span class="keywordflow">return</span> $copyOID;</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;  }</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;<span class="comment">  /**</span></div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;<span class="comment">   * Get the copied node for a node id</span></div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;<span class="comment">   * @param $origOID The object id of the original node</span></div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;<span class="comment">   * @return Copied Node or null, if it does not exist already</span></div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;<span class="comment">   */</span></div>
<div class="line"><a name="l00467"></a><span class="lineno"><a class="line" href="classwcmf_1_1application_1_1controller_1_1_copy_controller.html#a61d7958d10a50fcd3966305bc98a41b2">  467</a></span>&#160;  <span class="keyword">protected</span> <span class="keyword">function</span> <a class="code" href="classwcmf_1_1application_1_1controller_1_1_copy_controller.html#a61d7958d10a50fcd3966305bc98a41b2">getCopy</a>(<a class="code" href="classwcmf_1_1lib_1_1persistence_1_1_object_id.html">ObjectId</a> $origOID) {</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    $copyOID = $this-&gt;<a class="code" href="classwcmf_1_1application_1_1controller_1_1_copy_controller.html#a6b705c655ffb88c756bc0d8078c07975">getCopyOID</a>($origOID);</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    <span class="keywordflow">if</span> ($copyOID != null) {</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;      $persistenceFacade = $this-&gt;<a class="code" href="classwcmf_1_1lib_1_1presentation_1_1_controller.html#ad01d1e66179edfeb910b32001222361d">getPersistenceFacade</a>();</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;      $nodeCopy = $persistenceFacade-&gt;load($copyOID);</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;      <span class="keywordflow">return</span> $nodeCopy;</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    }</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;      <span class="keywordflow">return</span> null;</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    }</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;  }</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;<span class="comment">  /**</span></div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;<span class="comment">   * Modify the given Node before save action (Called only for the copied root Node, not for its children)</span></div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;<span class="comment">   * @note Subclasses will override this to implement special application requirements.</span></div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;<span class="comment">   * @param $node A reference to the Node to modify.</span></div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;<span class="comment">   * @return Boolean whether the Node was modified (default: false)</span></div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;<span class="comment">   */</span></div>
<div class="line"><a name="l00485"></a><span class="lineno"><a class="line" href="classwcmf_1_1application_1_1controller_1_1_copy_controller.html#aed1f22bd7cbc1e41053fb78f4fcb345f">  485</a></span>&#160;  <span class="keyword">protected</span> <span class="keyword">function</span> <a class="code" href="classwcmf_1_1application_1_1controller_1_1_copy_controller.html#aed1f22bd7cbc1e41053fb78f4fcb345f">modify</a>(<a class="code" href="interfacewcmf_1_1lib_1_1persistence_1_1_persistent_object.html">PersistentObject</a> $node) {</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;  }</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;}</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;?&gt;</div>
<div class="ttc" id="interfacewcmf_1_1lib_1_1presentation_1_1_response_html"><div class="ttname"><a href="interfacewcmf_1_1lib_1_1presentation_1_1_response.html">wcmf\lib\presentation\Response</a></div><div class="ttdoc">Response holds the response values that are used as output from Controller instances. </div><div class="ttdef"><b>Definition:</b> <a href="_response_8php_source.html#l00020">Response.php:20</a></div></div>
<div class="ttc" id="classwcmf_1_1lib_1_1presentation_1_1_controller_html_adf1a35ad20e475c59cc0967d5764aa22"><div class="ttname"><a href="classwcmf_1_1lib_1_1presentation_1_1_controller.html#adf1a35ad20e475c59cc0967d5764aa22">wcmf\lib\presentation\Controller\getRequest</a></div><div class="ttdeci">getRequest()</div><div class="ttdoc">Get the Request instance. </div><div class="ttdef"><b>Definition:</b> <a href="_controller_8php_source.html#l00190">Controller.php:190</a></div></div>
<div class="ttc" id="namespacewcmf_1_1lib_1_1presentation_1_1_response_html"><div class="ttname"><a href="namespacewcmf_1_1lib_1_1presentation_1_1_response.html">Response</a></div></div>
<div class="ttc" id="classwcmf_1_1application_1_1controller_1_1_copy_controller_html_a6a579224d13256212b3e8fc47bb44814"><div class="ttname"><a href="classwcmf_1_1application_1_1controller_1_1_copy_controller.html#a6a579224d13256212b3e8fc47bb44814">wcmf\application\controller\CopyController\copyNode</a></div><div class="ttdeci">copyNode(ObjectId $oid)</div><div class="ttdoc">Create a copy of the node with the given object id. </div><div class="ttdef"><b>Definition:</b> <a href="_copy_controller_8php_source.html#l00328">CopyController.php:328</a></div></div>
<div class="ttc" id="interfacewcmf_1_1lib_1_1persistence_1_1_persistent_object_html_ac886ae95a746f43906bb3b2515092440"><div class="ttname"><a href="interfacewcmf_1_1lib_1_1persistence_1_1_persistent_object.html#ac886ae95a746f43906bb3b2515092440">wcmf\lib\persistence\PersistentObject\getOID</a></div><div class="ttdeci">getOID()</div><div class="ttdoc">Get the object id of the PersistentObject. </div></div>
<div class="ttc" id="classwcmf_1_1application_1_1controller_1_1_copy_controller_html_a6b705c655ffb88c756bc0d8078c07975"><div class="ttname"><a href="classwcmf_1_1application_1_1controller_1_1_copy_controller.html#a6b705c655ffb88c756bc0d8078c07975">wcmf\application\controller\CopyController\getCopyOID</a></div><div class="ttdeci">getCopyOID(ObjectId $origOID)</div><div class="ttdoc">Get the object id of the copied node for a node id. </div><div class="ttdef"><b>Definition:</b> <a href="_copy_controller_8php_source.html#l00444">CopyController.php:444</a></div></div>
<div class="ttc" id="classwcmf_1_1lib_1_1presentation_1_1_controller_html_a0b0e611236742aac18ba1936d03ba89a"><div class="ttname"><a href="classwcmf_1_1lib_1_1presentation_1_1_controller.html#a0b0e611236742aac18ba1936d03ba89a">wcmf\lib\presentation\Controller\getMessage</a></div><div class="ttdeci">getMessage()</div><div class="ttdoc">Get the Message instance. </div><div class="ttdef"><b>Definition:</b> <a href="_controller_8php_source.html#l00254">Controller.php:254</a></div></div>
<div class="ttc" id="namespacewcmf_1_1lib_1_1persistence_1_1_persistent_object_html"><div class="ttname"><a href="namespacewcmf_1_1lib_1_1persistence_1_1_persistent_object.html">PersistentObject</a></div></div>
<div class="ttc" id="namespacewcmf_1_1lib_1_1model_1_1_persistent_iterator_html"><div class="ttname"><a href="namespacewcmf_1_1lib_1_1model_1_1_persistent_iterator.html">PersistentIterator</a></div></div>
<div class="ttc" id="classwcmf_1_1lib_1_1model_1_1_persistent_iterator_html_a9f718c0c21b0451481dcc093e7fdadf8"><div class="ttname"><a href="classwcmf_1_1lib_1_1model_1_1_persistent_iterator.html#a9f718c0c21b0451481dcc093e7fdadf8">wcmf\lib\model\PersistentIterator\load</a></div><div class="ttdeci">static load($persistenceFacade, $session, $uid)</div><div class="ttdoc">Load an iterator state from the session. </div><div class="ttdef"><b>Definition:</b> <a href="_persistent_iterator_8php_source.html#l00081">PersistentIterator.php:81</a></div></div>
<div class="ttc" id="classwcmf_1_1application_1_1controller_1_1_batch_controller_html_ab0e75dc0967afe71da4d6bd46d7a500b"><div class="ttname"><a href="classwcmf_1_1application_1_1controller_1_1_batch_controller.html#ab0e75dc0967afe71da4d6bd46d7a500b">wcmf\application\controller\BatchController\addWorkPackage</a></div><div class="ttdeci">addWorkPackage($name, $size, $oids, $callback, $args=null)</div><div class="ttdoc">Add a work package to session. </div><div class="ttdef"><b>Definition:</b> <a href="_batch_controller_8php_source.html#l00200">BatchController.php:200</a></div></div>
<div class="ttc" id="classwcmf_1_1application_1_1controller_1_1_copy_controller_html_acdeb10247722f1d8439e86db3f63f3e5"><div class="ttname"><a href="classwcmf_1_1application_1_1controller_1_1_copy_controller.html#acdeb10247722f1d8439e86db3f63f3e5">wcmf\application\controller\CopyController\endProcess</a></div><div class="ttdeci">endProcess(ObjectId $oid)</div><div class="ttdoc">Finish the process and set the result. </div><div class="ttdef"><b>Definition:</b> <a href="_copy_controller_8php_source.html#l00309">CopyController.php:309</a></div></div>
<div class="ttc" id="classwcmf_1_1application_1_1controller_1_1_copy_controller_html_a184909dab34698899937d810a9f5d393"><div class="ttname"><a href="classwcmf_1_1application_1_1controller_1_1_copy_controller.html#a184909dab34698899937d810a9f5d393">wcmf\application\controller\CopyController\validate</a></div><div class="ttdeci">validate()</div><div class="ttdef"><b>Definition:</b> <a href="_copy_controller_8php_source.html#l00097">CopyController.php:97</a></div></div>
<div class="ttc" id="classwcmf_1_1lib_1_1persistence_1_1_object_id_html"><div class="ttname"><a href="classwcmf_1_1lib_1_1persistence_1_1_object_id.html">wcmf\lib\persistence\ObjectId</a></div><div class="ttdoc">ObjectId is the unique identifier of an object. </div><div class="ttdef"><b>Definition:</b> <a href="_object_id_8php_source.html#l00027">ObjectId.php:27</a></div></div>
<div class="ttc" id="classwcmf_1_1application_1_1controller_1_1_copy_controller_html_a823495e057cd13b2aa84fc913a832f26"><div class="ttname"><a href="classwcmf_1_1application_1_1controller_1_1_copy_controller.html#a823495e057cd13b2aa84fc913a832f26">wcmf\application\controller\CopyController\registerCopy</a></div><div class="ttdeci">registerCopy(PersistentObject $origNode, PersistentObject $copyNode)</div><div class="ttdoc">Register a copied node in the session for later reference. </div><div class="ttdef"><b>Definition:</b> <a href="_copy_controller_8php_source.html#l00409">CopyController.php:409</a></div></div>
<div class="ttc" id="namespacewcmf_1_1lib_1_1presentation_1_1_request_html"><div class="ttname"><a href="namespacewcmf_1_1lib_1_1presentation_1_1_request.html">Request</a></div></div>
<div class="ttc" id="namespacewcmf_1_1lib_1_1persistence_1_1_persistence_exception_html"><div class="ttname"><a href="namespacewcmf_1_1lib_1_1persistence_1_1_persistence_exception.html">PersistenceException</a></div></div>
<div class="ttc" id="classwcmf_1_1application_1_1controller_1_1_copy_controller_html_a47a24ac0d700f62a9434d298ade72fb9"><div class="ttname"><a href="classwcmf_1_1application_1_1controller_1_1_copy_controller.html#a47a24ac0d700f62a9434d298ade72fb9">wcmf\application\controller\CopyController\initialize</a></div><div class="ttdeci">initialize(Request $request, Response $response)</div><div class="ttdef"><b>Definition:</b> <a href="_copy_controller_8php_source.html#l00072">CopyController.php:72</a></div></div>
<div class="ttc" id="interfacewcmf_1_1lib_1_1presentation_1_1_controller_message_html_a189a4abe5faf11f4320d5d3f1d3d1715"><div class="ttname"><a href="interfacewcmf_1_1lib_1_1presentation_1_1_controller_message.html#a189a4abe5faf11f4320d5d3f1d3d1715">wcmf\lib\presentation\ControllerMessage\getAction</a></div><div class="ttdeci">getAction()</div><div class="ttdoc">Get the name of the action. </div></div>
<div class="ttc" id="classwcmf_1_1application_1_1controller_1_1_copy_controller_html_a6014d16f402330aef2316a435da3c213"><div class="ttname"><a href="classwcmf_1_1application_1_1controller_1_1_copy_controller.html#a6014d16f402330aef2316a435da3c213">wcmf\application\controller\CopyController\updateCopyOIDs</a></div><div class="ttdeci">updateCopyOIDs(array $oidMap)</div><div class="ttdoc">Update the copied oids in the registry. </div><div class="ttdef"><b>Definition:</b> <a href="_copy_controller_8php_source.html#l00421">CopyController.php:421</a></div></div>
<div class="ttc" id="namespacewcmf_1_1lib_1_1persistence_1_1_object_id_html"><div class="ttname"><a href="namespacewcmf_1_1lib_1_1persistence_1_1_object_id.html">ObjectId</a></div></div>
<div class="ttc" id="classwcmf_1_1application_1_1controller_1_1_copy_controller_html_aed1f22bd7cbc1e41053fb78f4fcb345f"><div class="ttname"><a href="classwcmf_1_1application_1_1controller_1_1_copy_controller.html#aed1f22bd7cbc1e41053fb78f4fcb345f">wcmf\application\controller\CopyController\modify</a></div><div class="ttdeci">modify(PersistentObject $node)</div><div class="ttdoc">Modify the given Node before save action (Called only for the copied root Node, not for its children)...</div><div class="ttdef"><b>Definition:</b> <a href="_copy_controller_8php_source.html#l00485">CopyController.php:485</a></div></div>
<div class="ttc" id="interfacewcmf_1_1lib_1_1presentation_1_1_request_html"><div class="ttname"><a href="interfacewcmf_1_1lib_1_1presentation_1_1_request.html">wcmf\lib\presentation\Request</a></div><div class="ttdoc">Request holds the request values that are used as input to Controller instances. </div><div class="ttdef"><b>Definition:</b> <a href="_request_8php_source.html#l00020">Request.php:20</a></div></div>
<div class="ttc" id="classwcmf_1_1application_1_1controller_1_1_batch_controller_html"><div class="ttname"><a href="classwcmf_1_1application_1_1controller_1_1_batch_controller.html">wcmf\application\controller\BatchController</a></div><div class="ttdoc">BatchController is used to process complex, longer running actions, that need to be divided into seve...</div><div class="ttdef"><b>Definition:</b> <a href="_batch_controller_8php_source.html#l00069">BatchController.php:69</a></div></div>
<div class="ttc" id="classwcmf_1_1application_1_1controller_1_1_copy_controller_html_a2255ef44e4296fb56725bc04220f2a96"><div class="ttname"><a href="classwcmf_1_1application_1_1controller_1_1_copy_controller.html#a2255ef44e4296fb56725bc04220f2a96">wcmf\application\controller\CopyController\copyNodes</a></div><div class="ttdeci">copyNodes($oids)</div><div class="ttdoc">Copy nodes provided by the persisted iterator (oids parameter will be ignored) </div><div class="ttdef"><b>Definition:</b> <a href="_copy_controller_8php_source.html#l00256">CopyController.php:256</a></div></div>
<div class="ttc" id="classwcmf_1_1lib_1_1persistence_1_1_object_id_html_a2441c8f369adef96455b48af3467b42f"><div class="ttname"><a href="classwcmf_1_1lib_1_1persistence_1_1_object_id.html#a2441c8f369adef96455b48af3467b42f">wcmf\lib\persistence\ObjectId\parse</a></div><div class="ttdeci">static parse($oid)</div><div class="ttdoc">Parse a serialized object id string into an ObjectId instance. </div><div class="ttdef"><b>Definition:</b> <a href="_object_id_8php_source.html#l00144">ObjectId.php:144</a></div></div>
<div class="ttc" id="interfacewcmf_1_1lib_1_1presentation_1_1_controller_message_html_a270bd65d789405427f5005ef5b0e0f38"><div class="ttname"><a href="interfacewcmf_1_1lib_1_1presentation_1_1_controller_message.html#a270bd65d789405427f5005ef5b0e0f38">wcmf\lib\presentation\ControllerMessage\hasValue</a></div><div class="ttdeci">hasValue($name)</div><div class="ttdoc">Check for existance of a value. </div></div>
<div class="ttc" id="classwcmf_1_1lib_1_1persistence_1_1_persistence_exception_html"><div class="ttname"><a href="classwcmf_1_1lib_1_1persistence_1_1_persistence_exception.html">wcmf\lib\persistence\PersistenceException</a></div><div class="ttdoc">PersistenceException signals an exception in the persistence service. </div><div class="ttdef"><b>Definition:</b> <a href="_persistence_exception_8php_source.html#l00018">PersistenceException.php:18</a></div></div>
<div class="ttc" id="namespacewcmf_1_1application_1_1controller_1_1_batch_controller_html"><div class="ttname"><a href="namespacewcmf_1_1application_1_1controller_1_1_batch_controller.html">BatchController</a></div></div>
<div class="ttc" id="classwcmf_1_1lib_1_1persistence_1_1_object_id_html_a7516ca30af0db3cdbf9a7739b48ce91d"><div class="ttname"><a href="classwcmf_1_1lib_1_1persistence_1_1_object_id.html#a7516ca30af0db3cdbf9a7739b48ce91d">wcmf\lib\persistence\ObjectId\__toString</a></div><div class="ttdeci">__toString()</div><div class="ttdoc">Get a string representation of the object id. </div><div class="ttdef"><b>Definition:</b> <a href="_object_id_8php_source.html#l00204">ObjectId.php:204</a></div></div>
<div class="ttc" id="classwcmf_1_1application_1_1controller_1_1_copy_controller_html"><div class="ttname"><a href="classwcmf_1_1application_1_1controller_1_1_copy_controller.html">wcmf\application\controller\CopyController</a></div><div class="ttdoc">CopyController is used to copy or move Node instances. </div><div class="ttdef"><b>Definition:</b> <a href="_copy_controller_8php_source.html#l00057">CopyController.php:57</a></div></div>
<div class="ttc" id="namespacewcmf_1_1application_1_1controller_html"><div class="ttname"><a href="namespacewcmf_1_1application_1_1controller.html">wcmf\application\controller</a></div><div class="ttdoc">Application controllers. </div><div class="ttdef"><b>Definition:</b> <a href="namespaces_8php_source.html#l00003">namespaces.php:3</a></div></div>
<div class="ttc" id="interfacewcmf_1_1lib_1_1presentation_1_1_controller_message_html_a8e7aaacf604710d7f853f3261d84b9fc"><div class="ttname"><a href="interfacewcmf_1_1lib_1_1presentation_1_1_controller_message.html#a8e7aaacf604710d7f853f3261d84b9fc">wcmf\lib\presentation\ControllerMessage\setValue</a></div><div class="ttdeci">setValue($name, $value)</div><div class="ttdoc">Set a value. </div></div>
<div class="ttc" id="classwcmf_1_1application_1_1controller_1_1_copy_controller_html_a3b581a2091b700061c9426fde625b3eb"><div class="ttname"><a href="classwcmf_1_1application_1_1controller_1_1_copy_controller.html#a3b581a2091b700061c9426fde625b3eb">wcmf\application\controller\CopyController\startProcess</a></div><div class="ttdeci">startProcess($oids)</div><div class="ttdoc">Copy/Move the first node (oids parameter will be ignored) </div><div class="ttdef"><b>Definition:</b> <a href="_copy_controller_8php_source.html#l00177">CopyController.php:177</a></div></div>
<div class="ttc" id="classwcmf_1_1lib_1_1presentation_1_1_application_error_html_a7b6de2953b070910660cee9f229bc554"><div class="ttname"><a href="classwcmf_1_1lib_1_1presentation_1_1_application_error.html#a7b6de2953b070910660cee9f229bc554">wcmf\lib\presentation\ApplicationError\get</a></div><div class="ttdeci">static get($code, $data=null)</div><div class="ttdoc">Factory method for retrieving a predefind error instance. </div><div class="ttdef"><b>Definition:</b> <a href="_application_error_8php_source.html#l00120">ApplicationError.php:120</a></div></div>
<div class="ttc" id="classwcmf_1_1lib_1_1model_1_1_persistent_iterator_html"><div class="ttname"><a href="classwcmf_1_1lib_1_1model_1_1_persistent_iterator.html">wcmf\lib\model\PersistentIterator</a></div><div class="ttdoc">PersistentIterator is used to iterate over a tree/list built of oids using a Depth-First-Algorithm. </div><div class="ttdef"><b>Definition:</b> <a href="_persistent_iterator_8php_source.html#l00025">PersistentIterator.php:25</a></div></div>
<div class="ttc" id="classwcmf_1_1lib_1_1presentation_1_1_controller_html_a2321df4f2f7d188b92b96fe63dc71a90"><div class="ttname"><a href="classwcmf_1_1lib_1_1presentation_1_1_controller.html#a2321df4f2f7d188b92b96fe63dc71a90">wcmf\lib\presentation\Controller\getLogger</a></div><div class="ttdeci">getLogger()</div><div class="ttdoc">Get the Logger instance. </div><div class="ttdef"><b>Definition:</b> <a href="_controller_8php_source.html#l00206">Controller.php:206</a></div></div>
<div class="ttc" id="classwcmf_1_1lib_1_1presentation_1_1_controller_html_a6c907e8af775e517a77037dd0164222f"><div class="ttname"><a href="classwcmf_1_1lib_1_1presentation_1_1_controller.html#a6c907e8af775e517a77037dd0164222f">wcmf\lib\presentation\Controller\getResponse</a></div><div class="ttdeci">getResponse()</div><div class="ttdoc">Get the Response instance. </div><div class="ttdef"><b>Definition:</b> <a href="_controller_8php_source.html#l00198">Controller.php:198</a></div></div>
<div class="ttc" id="classwcmf_1_1lib_1_1presentation_1_1_controller_html_aefa4c5bd150e2a7d525576d7959c6911"><div class="ttname"><a href="classwcmf_1_1lib_1_1presentation_1_1_controller.html#aefa4c5bd150e2a7d525576d7959c6911">wcmf\lib\presentation\Controller\getSession</a></div><div class="ttdeci">getSession()</div><div class="ttdoc">Get the Session instance. </div><div class="ttdef"><b>Definition:</b> <a href="_controller_8php_source.html#l00214">Controller.php:214</a></div></div>
<div class="ttc" id="classwcmf_1_1application_1_1controller_1_1_copy_controller_html_a61d7958d10a50fcd3966305bc98a41b2"><div class="ttname"><a href="classwcmf_1_1application_1_1controller_1_1_copy_controller.html#a61d7958d10a50fcd3966305bc98a41b2">wcmf\application\controller\CopyController\getCopy</a></div><div class="ttdeci">getCopy(ObjectId $origOID)</div><div class="ttdoc">Get the copied node for a node id. </div><div class="ttdef"><b>Definition:</b> <a href="_copy_controller_8php_source.html#l00467">CopyController.php:467</a></div></div>
<div class="ttc" id="classwcmf_1_1application_1_1controller_1_1_copy_controller_html_a223349db2074bd54262570eaff288364"><div class="ttname"><a href="classwcmf_1_1application_1_1controller_1_1_copy_controller.html#a223349db2074bd54262570eaff288364">wcmf\application\controller\CopyController\getTargetNode</a></div><div class="ttdeci">getTargetNode(ObjectId $targetOID)</div><div class="ttdoc">Get the target node from the request parameter targetoid. </div><div class="ttdef"><b>Definition:</b> <a href="_copy_controller_8php_source.html#l00394">CopyController.php:394</a></div></div>
<div class="ttc" id="classwcmf_1_1application_1_1controller_1_1_copy_controller_html_aa969f966d1ab74704cbde9512d281d2c"><div class="ttname"><a href="classwcmf_1_1application_1_1controller_1_1_copy_controller.html#aa969f966d1ab74704cbde9512d281d2c">wcmf\application\controller\CopyController\getWorkPackage</a></div><div class="ttdeci">getWorkPackage($number)</div><div class="ttdef"><b>Definition:</b> <a href="_copy_controller_8php_source.html#l00153">CopyController.php:153</a></div></div>
<div class="ttc" id="namespacewcmf_1_1lib_1_1presentation_1_1_application_error_html"><div class="ttname"><a href="namespacewcmf_1_1lib_1_1presentation_1_1_application_error.html">ApplicationError</a></div></div>
<div class="ttc" id="namespacewcmf_1_1lib_1_1model_1_1_node_util_html"><div class="ttname"><a href="namespacewcmf_1_1lib_1_1model_1_1_node_util.html">NodeUtil</a></div></div>
<div class="ttc" id="classwcmf_1_1lib_1_1presentation_1_1_controller_html_ad01d1e66179edfeb910b32001222361d"><div class="ttname"><a href="classwcmf_1_1lib_1_1presentation_1_1_controller.html#ad01d1e66179edfeb910b32001222361d">wcmf\lib\presentation\Controller\getPersistenceFacade</a></div><div class="ttdeci">getPersistenceFacade()</div><div class="ttdoc">Get the PersistenceFacade instance. </div><div class="ttdef"><b>Definition:</b> <a href="_controller_8php_source.html#l00222">Controller.php:222</a></div></div>
<div class="ttc" id="interfacewcmf_1_1lib_1_1persistence_1_1_persistent_object_html"><div class="ttname"><a href="interfacewcmf_1_1lib_1_1persistence_1_1_persistent_object.html">wcmf\lib\persistence\PersistentObject</a></div><div class="ttdoc">PersistentObject defines the interface of all persistent objects. </div><div class="ttdef"><b>Definition:</b> <a href="_persistent_object_8php_source.html#l00024">PersistentObject.php:24</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
      </div>
    </div>
  </div>
</div>
<hr>
<footer>
  <div class="container">
    <div class="row">
      <div class="col-md-9">
        <small>&copy; 2016 <a href="http://www.wemove.com" target="_blank">wemove digital solutions</a><br>
          Generated on Fri Jul 15 2016 22:20:36 for wCMF by &#160;<a href="http://www.doxygen.org/index.html" target="_blank">doxygen</a> 1.8.10</small>
      </div>
    </div>
  </div>
</footer>
</body>
</html>
